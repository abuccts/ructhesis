% \iffalse meta-comment
%
% Copyright (C) 2005-2016 by Ruini Xue <xueruini@gmail.com>
% Copyright (C) 2017 by Yifan Xiong <abuccts@gmail.com>
%
% This file may be distributed and/or modified under the
% conditions of the LaTeX Project Public License, either version 1.3a
% of this license or (at your option) any later version.
% The latest version of this license is in:
%
% http://www.latex-project.org/lppl.txt
%
% and version 1.3a or later is part of all distributions of LaTeX
% version 2004/10/01 or later.
%
% \fi
%
% \iffalse
%<*driver>
\ProvidesFile{ructhesis.dtx}[2017/05/09 0.0.1 Renmin University of China Thesis Template]
\documentclass{ltxdoc}
\usepackage{dtx-style}

\EnableCrossrefs
\CodelineIndex
\RecordChanges

\begin{document}
  \DocInput{\jobname.dtx}
\end{document}
%</driver>
% \fi
%
% \CheckSum{0}
%
% \CharacterTable
%  {Upper-case    \A\B\C\D\E\F\G\H\I\J\K\L\M\N\O\P\Q\R\S\T\U\V\W\X\Y\Z
%   Lower-case    \a\b\c\d\e\f\g\h\i\j\k\l\m\n\o\p\q\r\s\t\u\v\w\x\y\z
%   Digits        \0\1\2\3\4\5\6\7\8\9
%   Exclamation   \!     Double quote  \"     Hash (number) \#
%   Dollar        \$     Percent       \%     Ampersand     \&
%   Acute accent  \'     Left paren    \(     Right paren   \)
%   Asterisk      \*     Plus          \+     Comma         \,
%   Minus         \-     Point         \.     Solidus       \/
%   Colon         \:     Semicolon     \;     Less than     \<
%   Equals        \=     Greater than  \>     Question mark \?
%   Commercial at \@     Left bracket  \[     Backslash     \\
%   Right bracket \]     Circumflex    \^     Underscore    \_
%   Grave accent  \`     Left brace    \{     Vertical bar  \|
%   Right brace   \}     Tilde         \~}
%
% \DoNotIndex{\newenvironment,\@bsphack,\@empty,\@esphack,\sfcode}
% \DoNotIndex{\addtocounter,\label,\let,\linewidth,\newcounter}
% \DoNotIndex{\noindent,\normalfont,\par,\parskip,\phantomsection}
% \DoNotIndex{\providecommand,\ProvidesPackage,\refstepcounter}
% \DoNotIndex{\RequirePackage,\setcounter,\setlength,\string,\strut}
% \DoNotIndex{\textbackslash,\texttt,\ttfamily,\usepackage}
% \DoNotIndex{\begin,\end,\begingroup,\endgroup,\par,\\}
% \DoNotIndex{\if,\ifx,\ifdim,\ifnum,\ifcase,\else,\or,\fi}
% \DoNotIndex{\let,\def,\xdef,\edef,\newcommand,\renewcommand}
% \DoNotIndex{\expandafter,\csname,\endcsname,\relax,\protect}
% \DoNotIndex{\Huge,\huge,\LARGE,\Large,\large,\normalsize}
% \DoNotIndex{\small,\footnotesize,\scriptsize,\tiny}
% \DoNotIndex{\normalfont,\bfseries,\slshape,\sffamily,\interlinepenalty}
% \DoNotIndex{\textbf,\textit,\textsf,\textsc}
% \DoNotIndex{\hfil,\par,\hskip,\vskip,\vspace,\quad}
% \DoNotIndex{\centering,\raggedright,\ref}
% \DoNotIndex{\c@secnumdepth,\@startsection,\@setfontsize}
% \DoNotIndex{\ ,\@plus,\@minus,\p@,\z@,\@m,\@M,\@ne,\m@ne}
% \DoNotIndex{\@@par,\DeclareOperation,\RequirePackage,\LoadClass}
% \DoNotIndex{\AtBeginDocument,\AtEndDocument}
%
% \GetFileInfo{\jobname.dtx}
%
% \changes{thuthesis v1.0}{2005/07/06}{Please refer to ``Bao--Pan'' version.}
% \changes{thuthesis v1.1}{2005/11/03}{Initial version, migrate from the old ``Bao--Pan''
% version. Make the template a class instead of package.}
% \changes{thuthesis v1.2}{2005/11/04}{Remove \pkg{fancyref}; Remove \pkg{ucite} and implement
% \cs{onlinecite}; use package \pkg{arial} or \pkg{helvet} selectively.}
% \changes{thuthesis v1.3}{2005/11/14}{Replace \pkg{subfigure} with \pkg{subfig}, replace \pkg{caption2}
% with \pkg{caption}, add details about using figure are in the example.}
% \changes{thuthesis v1.4rc1}{2005/11/20}{I do not know why \cs{thu@authorizationaddon} does not work
% now for v1.3, while it's fine in v1.2. Temporarily, I remove the directive
% :(. There might be better solution. Other changes: add \option{config} option to
% subfig to be compatible with subfigure. add \pkg{courier} package for tt font.}
% \changes{thuthesis v1.4}{2005/12/05}{Fix the problem of \textbf{chinese}, which is
% because both CJK and everysel redefine the \cs{selectfont}. So, a not so good
% workaround is merge them up. Add \file{shuji.tex} example. Add \cs{pozhehao} command.}
% \changes{thuthesis v2.1}{2006/02/27}{Add support to bachelor thesis.}
% \changes{thuthesis v2.1}{2006/03/01}{Remove \pkg{fancyhdr} and \pkg{geometry}.}
% \changes{thuthesis v2.1}{2006/03/01}{Redefine footnote marks.}
% \changes{thuthesis v2.1}{2006/03/01}{Replace \file{thubib.bst} with \file{chinesebst.bst}.}
% \changes{thuthesis v2.1}{2006/03/02}{Merge the modification of \pkg{ntheorem}.}
% \changes{thuthesis v2.1}{2006/03/02}{Remove \pkg{footmisc} and refine the document.}
% \changes{thuthesis v2.1}{2006/03/03}{Work very hard on the document.}
% \changes{thuthesis v2.1}{2006/03/03}{Add \cs{checklab} code to reduce ``unresolved labels'' warning}
% \changes{thuthesis v2.2}{2006/03/26}{Adjust margins. How bad it is to simulate MS WORD!.}
% \changes{thuthesis v2.2}{2006/03/26}{Add bachelor training overview details supporting.}
% \changes{thuthesis v2.2}{2006/03/26}{CJK support in preamble.}
% \changes{thuthesis v2.2}{2006/03/26}{Adjust hyperref to avoid boxes around links.}
% \changes{thuthesis v2.3}{2006/04/07}{Fix a great bug: \cs{PassOptionsToClass} and \cs{LoadClass}
% rather than \cs{PassOptionToPackage} and \cs{LoadPackage}.}
% \changes{thuthesis v2.3}{2006/04/07}{Reorganize the codes in cover, make the pagestyle more readable.}
% \changes{thuthesis v2.3}{2006/04/07}{Add gbk2uni into the document.}
% \changes{thuthesis v2.3}{2006/04/07}{Support \option{openright} and openany.}
% \changes{thuthesis v2.3}{2006/04/09}{Adjust \cs{hypersetup} to remove color and box.}
% \changes{thuthesis v2.3}{2006/04/09}{Adjust margins again.}
% \changes{thuthesis v2.3}{2006/04/09}{Adjust references formats.}
% \changes{thuthesis v2.3}{2006/04/09}{Redefine frontmatter and mainmatter to fit our case.}
% \changes{thuthesis v2.3}{2006/04/09}{Add assumption environment.}
% \changes{thuthesis v2.3}{2006/04/09}{Change the brace in the cover.}
% \changes{thuthesis v2.4}{2006/04/14}{Fill more pdf info. with \cs{hypersetup}.}
% \changes{thuthesis v2.4}{2006/04/14}{自动隐藏密级为内部时后面的五角星。}
% \changes{thuthesis v2.4}{2006/04/14}{增加“注释 (Remark)”环境。}
% \changes{thuthesis v2.4}{2006/04/14}{压缩 item 之间的距离。}
% \changes{thuthesis v2.4}{2006/04/14}{\file{thubib.bst} 文献标题取消自动小写。}
% \changes{thuthesis v2.4}{2006/04/14}{中文参考文献取消 In: Proceedings。}
% \changes{thuthesis v2.4}{2006/04/14}{英文文参考文献调整 In: editor, Proceedings。}
% \changes{thuthesis v2.4}{2006/04/14}{参考文献为学位论文时，加方括号，作者后面为实心点。}
% \changes{thuthesis v2.4}{2006/04/14}{中文参考文献作者超过三个加等。}
% \changes{thuthesis v2.4}{2006/04/14}{中文参考文献需要在 bib 中指定 |lang="chinese"|。}
% \changes{thuthesis v2.4}{2006/04/14}{学位论文不在需要 type 字段。}
% \changes{thuthesis v2.4}{2006/04/14}{为摘要等条目增加书签。}
% \changes{thuthesis v2.4}{2006/04/14}{章节的编号用黑体，也就是自动打开 \option{arialtitle} 选项。}
% \changes{thuthesis v2.4.1}{2006/04/17}{2.4 忘了把关键词的 tabular 改成 thu@tabular。}
% \changes{thuthesis v2.4.1}{2006/04/17}{参考文献最后一个作者前是逗号而不是 and。}
% \changes{thuthesis v2.4.2}{2006/04/18}{去掉参考文献第二个作者后面烦人的逗号。}
% \changes{thuthesis v2.5}{2006/05/19}{对本科论文进行大幅度的重写，因为教务处修改了格式要求。}
% \changes{thuthesis v2.5}{2006/05/19}{重新整理代码，使其布局更易读。}
% \changes{thuthesis v2.5.1}{2006/05/24}{如果选项设置了 dvips，但是用 PDF\LaTeX\ 编译，报错。}
% \changes{thuthesis v2.5.1}{2006/05/24}{根据教务处的新要求调整附录部分。}
% \changes{thuthesis v2.5.1}{2006/05/25}{参考文献中杂志文章如果没有卷号，那么页码直接跟在
% 年份后面，并用句点分割。在 \file{thubib.bst} 中增加 output.year 函数。}
% \changes{thuthesis v2.6}{2006/06/09}{增加 dvipdfm 选项。}
% \changes{thuthesis v2.6.1}{2006/06/16}{取消 \file{thubib.bst} 中 inbook 类 volume 后的页
% 码。}
% \changes{thuthesis v2.6.2}{2006/06/18}{改正 groupmembers 的拼写错误。}
% \changes{thuthesis v3.0}{2007/05/12}{不用专门为本科论文生成“\textbf{提交}”版本了。}
% \changes{thuthesis v3.0}{2007/05/12}{没有了综合论文训练页面，很多本科论文专用命令就消失了。}
% \changes{thuthesis v4.4}{2008/05/12}{修复网址断字。}
% \changes{thuthesis v4.5}{2008/01/03}{加入 \XeTeX\ 支持，需要 \pkg{xeCJK}。}
% \changes{thuthesis v4.5}{2008/01/04}{彻底转向 UTF-8，并支持 \XeLaTeX。}
% \changes{thuthesis v4.5}{2009/01/03}{增加 xetex, pdftex 选项。}
% \changes{thuthesis v4.6}{2011/04/27}{增加博士后文档部分。}
% \changes{thuthesis v4.6}{2011/10/22}{使用手册更新。}
% \changes{thuthesis v4.7}{2012/06/12}{去掉 \pkg{hypernat} 依赖，\pkg{hyperref} 和 \pkg{natbib} 可以很好配合了。}
% \changes{thuthesis v4.8}{2013/03/02}{no need to load \pkg{indentfirst} directly since we use \pkg{ctex}.}
% \changes{thuthesis v4.8}{2013/03/02}{内部调用 \pkg{ctex} 宏包，自动检测编译引擎。}
% \changes{thuthesis v4.8}{2013/03/04}{dvips method is deprecated. We ask their users to load it manually.}
% \changes{thuthesis v4.8}{2013/03/09}{reset baselinestretch after ctex's change.}
% \changes{thuthesis v4.8}{2014/11/25}{好几年累积的一些更新，最重要的是切换到 \CTeX。}
%
% \def\indexname{索引}
% \def\glossaryname{修改记录}
% \IndexPrologue{\section{\indexname}}
% \GlossaryPrologue{\section{\glossaryname}}
%
% \title{\bfseries\color{rucred}\ructhesis：中国人民大学学位论文模板}
% \author{{\fangsong 熊一帆}\\[5pt]\texttt{abuccts@gmail.com}}
% \date{v\fileversion\ (\filedate)}
% \maketitle\thispagestyle{empty}
%
%
% \begin{abstract}\noindent
%   此宏包旨在建立一个简单易用的中国人民大学学位论文 \LaTeX\ 模板，包括本科、硕士
% 以及博士论文。
% \end{abstract}
%
% \vskip2cm
% \def\abstractname{免责声明}
% \begin{abstract}
% \noindent
% \begin{enumerate}
% \item 本模板的发布遵守 \LaTeX\ Project Public License，使用前请认真阅读协议内
%   容。
% \item 本模板为作者根据中国人民大学教务处颁发的《毕业论文指导手册》编写而成，
% 旨在供中国人民大学毕业生撰写学位论文使用。
% \item 此模板仅为指导手册论文结构与格式要求的参考实现，不保证格式审查老师
%   不提意见。任何由于使用本模板而引起的论文格式审查问题均与本模板作者无关。
% \item 任何个人或组织以本模板为基础进行修改、扩展而生成的新的专用模板，请严格遵
%   守 \LaTeX\ Project Public License 协议。由于违犯协议而引起的任何纠纷争端均与
%   本模板作者无关。
% \end{enumerate}
% \end{abstract}
%
%
% \clearpage
% \pagestyle{fancy}
% \begin{multicols}{2}[
%   \setlength{\columnseprule}{.4pt}
%   \setlength{\columnsep}{18pt}]
%   \tableofcontents
% \end{multicols}
% \clearpage
%
% \section{模板介绍}
% \ructhesis\ (\textbf{R}enmin\textbf{U}niversity of \textbf{C}hina \LaTeX\
% \textbf{Thesis} Template) 是为了帮助中国人民大学毕业生撰写毕业论文而修改自
% ~\textsc{ThuThesis} 的 \LaTeX\ 论文模板。
%
% 本文档将尽量完整地介绍模板的使用方法，如有不清楚之处可以参考示例文档或者根据
% 第~\ref{sec:howtoask} 节说明提问，有兴趣者都可以参与完善此手册，也非常欢迎对代
% 码的贡献。
%
% \note[注意：]{模板的作用在于减少论文写作过程中格式调整的时间。前提是遵守模板的
% 用法，否则即便用了 \ructhesis\ 也难以保证输出的论文符合学校规范。}
%
%
% \section{安装}
% \label{sec:installation}
%
% 从 GitHub 上下载 \ructhesis\ ：
% \begin{shell}
% $ git clone https://github.com/abuccts/ructhesis.git
% \end{shell}
%
% \subsection{模板的组成}
% 下表列出了 \ructhesis\ 的主要文件及其功能介绍：
%
% \begin{longtable}{l|p{8cm}}
% \toprule
% {\heiti 文件（夹）} & {\heiti 功能描述}\\\midrule
% \endfirsthead
% \midrule
% {\heiti 文件（夹）} & {\heiti 功能描述}\\\midrule
% \endhead
% \endfoot
% \endlastfoot
% ructhesis.ins & \textsc{DocStrip} 驱动文件（开发用） \\
% ructhesis.dtx & \textsc{DocStrip} 源文件（开发用）\\\midrule
% ructhesis.cls & 模板类文件\\
% ructhesis.cfg & 模板配置文件\\
% ructhesis.bst & 参考文献样式文件\\\midrule
% main.tex & 示例文档主文件\\
% ref/ & 示例文档参考文献目录\\
% data/ & 示例文档章节具体内容\\
% figures/ & 示例文档图片路径\\
% ructhesis.sty & 为示例文档加载其它宏包\\\midrule
% Makefile & Makefile\\
% latexmkrc & latexmk 配置文件\\
% README.md & Readme\\
% \textbf{ructhesis.pdf} & 用户手册（本文档）\\\bottomrule
% \end{longtable}
%
% 几点说明：
% \begin{itemize}
% \item \file{ructhesis.cls} 和 \file{ructhesis.cfg} 可由 \file{ructhesis.ins}
%   和 \file{ructhesis.dtx} 生成，但为了降低新手用户的使用难度，故
%   将 \file{ructhesis.cls} 和 \file{ructhesis.cfg} 文件一起发布。
% \item 使用前阅读文档：\file{ructhesis.pdf}。
% \end{itemize}
%
% \subsection{生成模板}
% \label{sec:generate-cls}
%
% 从 GitHub 上克隆得到的目录为 \file{ructhesis}，
% 其中包括：模板源文件（\file{ructhesis.ins} 和 \file{ructhesis.dtx}），参考文献
% 样式 \file{ructhesis.bst}，示例文档
% （\file{main.tex}，\file{ructhesis.sty}\footnote{可能用到的包
% 以及一些命令定义都放在这里，以免 \file{ructhesis.cls} 过分臃
% 肿。}，\file{data/} 和 \file{figures/} 和 \file{ref/}）。在使用之前需要先生成模
% 板文件和配置文件（具体命令细节请参考 \file{README.md} 和 \file{Makefile}）：
%
% \begin{shell}
% $ cd ructhesis
% # 生成 ructhesis.cls 和 ructhesis.cfg
% $ latex ructhesis.ins
%
% # 下面的命令用来生成用户手册，可以不执行
% $ xelatex ructhesis.dtx
% $ makeindex -s gind.ist -o ructhesis.ind ructhesis.idx
% $ makeindex -s gglo.ist -o ructhesis.gls ructhesis.glo
% $ xelatex ructhesis.dtx
% $ xelatex ructhesis.dtx  % 生成说明文档 ructhesis.pdf
% \end{shell}
%
% \subsection{生成论文}
% \label{sec:generate-thesis}
% 本节介绍几种常见的生成论文的方法。用户可根据自己的情况选择。
%
% \subsubsection{\XeLaTeX}
% \label{sec:xelatex}
% 很多用户对 \LaTeX\ 命令执行的次数不太清楚。一个基本的原则是多次运行 \LaTeX\ 命
% 令直至不再出现警告。下面给出生成示例文档的详细过程（\texttt{\#} 开头的行为注
% 释），首先来看推荐的 \texttt{xelatex} 方式：
% \begin{shell}
% # 1. 发现里面的引用关系，文件后缀 .tex 可以省略
% $ xelatex main
%
% # 2. 编译参考文件源文件，生成 bbl 文件
% $ bibtex main
%
% # 3. 下面解决引用
% $ xelatex main
% $ xelatex main   # 此时生成完整的 pdf 文件
% \end{shell}
%
% \subsubsection{PDF\LaTeX}
% \label{sec:pdflatex}
% 如果使用 PDF\LaTeX，按照第~\ref{sec:xelatex} 节的顺序执行即可，只是将命令中
% \texttt{xelatex} 替换为 \texttt{pdflatex}。
%
% 需要注意的是 PDF\LaTeX\ 不能处理常见的 EPS 图形，需要先用 \texttt{epstopdf} 将其转化
% 成 PDF。不过 PDF\LaTeX\ 增加了对 png，jpg 等格式的支持，比较方便。\TeX Live
% 自从 2010 版本起自动调用 \texttt{epstopdf} 将 EPS 图形转化为 PDF。
%
% \subsubsection{latexmk}
% \label{sec:latexmk}
% \texttt{latexmk} 命令支持全自动生成 \LaTeX\ 编写的文档，并且支持使用不同的工具
% 链来进行生成，它会自动运行多次工具直到交叉引用都被解决。下面给出了一个用
% \texttt{latexmk} 调用 \texttt{xelatex} 生成最终文档的示例：
% \begin{shell}
% # 一句话就够了！
% $ latexmk -xelatex main
% \end{shell}
%
% \subsubsection{make}
% \label{sec:make}
%
% 上面的方法虽然不复杂，但是每次都输入还是非常罗嗦，所以 \ructhesis\ 提供了一
% 个 \file{Makefile}：
%
% \begin{shell}
% $ make clean
% $ make cls       # 生成 ructhesis.cls 和 ructhesis.cfg
% $ make doc       # 生成说明文档 ructhesis.pdf
% $ make thesis    # 生成示例文档 main.pdf
% \end{shell}
%
% \ructhesis\ 的 \file{Makefile} 默认用 \texttt{latexmk} 调用\texttt{xelatex} 编
% 译，此外还支持直接用 \texttt{xelatex} 和\texttt{pdflatex} 编译。如有需要可修
% 改 \file{Makefile} 开头的参数或通过命令行传递参数（请参看 \file{README.md}），
% 进一步还可以修改 \file{latexmkrc} 进行定制。
%
% \subsection{升级}
% \label{sec:updgrade}
% \ructhesis\ 升级非常简单，可以通过版本控制工具 git 更新，
% 或在 GitHub 上下载最新的 release 版本，
% 将 \file{ructhesis.ins}，\file{ructhesis.dtx} 和 \file{ructhesis.bst} 拷贝至
% 工作目录覆盖相应的文件，然后运行：
% \begin{shell}
% $ latex ructhesis.ins
% \end{shell}
%
% 生成新的类文件和配置文件即可。也可以直接拷
% 贝 \file{ructhesis.cls}，\file{ructhesis.cfg} 和 \file{ructhesis.bst}，免去上面命令
% 的执行。
%
%
% \section{使用说明}
% \label{sec:usage}
% 本手册假定用户已经能处理一般的 \LaTeX\ 文档，并对 \BibTeX\ 有一定了解。如果
% 从来没有接触过 \TeX\ 和 \LaTeX，建议先学习相关的基础知识。
%
% \subsection{关于提问}
% \label{sec:howtoask}
% 使用 GitHub Issue：
%
% \begin{itemize}
% \item \href{http://github.com/abuccts/ructhesis/issues}{Github Issues}
% \end{itemize}
%
% \subsection{示例文件}
% \label{sec:userguide}
% 模板核心文件有三
% 个：\file{ructhesis.cls}，\file{ructhesis.cfg} 和\file{ructhesis.bst}，但是如果
% 没有示例文档用户会发现很难下手。所以推荐新用户从模板自带的示例文档入手，里面包
% 括了论文写作用到的所有命令及其使用方法，只需要用自己的内容进行相应替换就可以。
% 对于不清楚的命令可以查阅本手册。下面的例子描述了模板中章节的组织形式，来自于示
% 例文档，具体内容可以参考模板附带的 \file{main.tex} 和 \file{data/}。
%
% \lstinputlisting[style=lstStyleLaTeX]{main.tex}
%
% \subsection{论文选项}
% \label{sec:option}
%
% \DescribeOption{type}
%   选择论文类型，当前支
%   持：\option{bachelor}，\option{master}，\option{doctor}。
%   为必选项。
% \begin{latex}
% % 本科论文
% \documentclass[type=bachelor]{ructhesis}
%
% % 博士论文
% \documentclass[type=doctor]{ructhesis}
% \end{latex}
%
% \DescribeOption{secret}
%   涉秘论文开关（默认：关闭）。第 \ref{sec:setup-secret} 节两个配置（或命
%   令）\cs{secretlevel}\marg{级别} 和 \cs{secretyear}\marg{年数} 分别用来指定保
%   密级别和时限。若不设置，则二者取默认值，分别为“\textbf{秘密}”和当前年份。
% \begin{latex}
% \documentclass[secret]{ructhesis} % 打开保密
% \documentclass[secret=false]{ructhesis} % 关闭保密
%
% \rucsetup{
%   secretlevel=公开,
%   secretyear=10
% }
% % 或者
% \secretlevel{保密}
% \secretyear{10}
% \end{latex}
%
% \DescribeOption{pifootnote}
% 是否使用 \pkg{pifont} 的带圈字符标记脚注编号。默认关闭，即使用\cs{textcircled}
% 命令，效果不太好，但是符合学校样式要求。不管使用哪种方式，一页的脚注建议控制
% 在 9 个以内，否则大于 10 的数字带圈的效果不太好。建议使用时打开此选项，脚注编号
% 很漂亮，如下：
% \begin{latex}
% \documentclass[pifootnote]{ructhesis}
% \end{latex}
%
% \DescribeOption{openany}
% \DescribeOption{openright}
% 正规出版物的章节出现在奇数页，也就是右手边的页面，这就是 \option{openright}，也
% 是 \ructhesis\ 的默认选项。在这种情况下，如果前一章的最后一页也是奇数，那么模板
% 会自动生成一个纯粹的空白页，很多人不是很习惯这种方式，而且学校的格式似乎更倾向
% 于页面连续，那就是通常所说的 \option{openany}\footnote{目前所有论文都
% 是 \option{openany}。}。这两个选项不用设置，\ructhesis\ 会根据当前论文类型自动选
% 择。
%
% \DescribeOption{arialtoc}
% 目录项（章目录项除外）中的英文是否用 \emph{Arial} 字体。本选项
% 和 \option{arialtitle} 都不用用户干预，模板根据当前论文类型自动设置。
%
% \DescribeOption{arialtitle}
% 章节标题中英文是否用 \emph{Arial} 字体（默认打开）。
%
% \subsection{中文字体}
% \label{sec:chinese-fonts}
%
% \subsubsection{字体配置}
% \label{sec:font-config}
% 正确配置中文字体是使用模板的第一步。模板调用 \CTeX\ 宏包，提供如下字体使用方式：
% \begin{itemize}
%   \item 基于传统 \pkg{CJK} 包，使用 \LaTeX、PDF\LaTeX\ 编译。
%   \item 基于 \pkg{xeCJK} 包，使用 \XeLaTeX\ 编译。（推荐方法）
% \end{itemize}
%
% 模板默认使用 \CTeX\ 的字体配置。关于中文字体安装、配置的所有问题不在本模板讨论
% 范围。
%
% \subsubsection{字体命令}
% \label{sec:fontcmds}
% \myentry{字体}
% \DescribeMacro{\songti}
% \DescribeMacro{\fangsong}
% \DescribeMacro{\heiti}
% \DescribeMacro{\kaishu}
% 用来切换宋体、仿宋、黑体、楷体四种基本字体。
%
% \begin{latex}
% {\songti 乾：元，亨，利贞}
% {\fangsong 初九，潜龙勿用}
% {\heiti 九二，见龙在田，利见大人}
% {\kaishu 九三，君子终日乾乾，夕惕若，厉，无咎}
% \end{latex}
%
% \myentry{字号}
% \DescribeMacro{\chuhao}
% \DescribeMacro{\xiaochu}
% \DescribeMacro{\yihao}
% \DescribeMacro{\xiaoyi}
% \DescribeMacro{\bahao}
% 定义字体大小，分别为：
%
% \begin{center}
% \begin{tabular}{llllll}
% \toprule
% \cs{chuhao} & \cs{xiaochu} & \cs{yihao}  & \cs{xiaoyi}    & \cs{erhao}  & \cs{xiaoer}\\
% \cs{sanhao} & \cs{xiaosan} & \cs{sihao}  & \cs{banxiaosi} & \cs{xiaosi} & \cs{dawu}\\
% \cs{wuhao}  & \cs{xiaowu}  & \cs{liuhao} & \cs{xiaoliu}   & \cs{qihao}  & \cs{bahao}\\\bottomrule
% \end{tabular}
% \end{center}
%
% 使用方法为：\cs{command}\oarg{num}，其中 command 为字号命令，num 为行距。比
% 如 \cs{xiaosi}[1.5] 表示选择小四字体，行距 1.5 倍。写作指南要求表格中的字体
% 是 \cs{dawu}，模板已经设置好了。
%
% \begin{latex}
% {\erhao 二号}
% {\sanhao[1.5] 三号}
% {\sihao 四号}
% {\qihao[2] 七号}
% \end{latex}
%
% 也可以使用 \CTeX\ 定义的 \cs{zihao}\marg{num} 来切换字号，具体用法参看其文
% 档。
%
% \subsection{封面信息}
% \label{sec:titlepage}
% 封面信息提供两种配置方法：一是通过统一设置命
% 令 \cs{rucsetup} 通过\emph{key=value} 形式完成；二是每个信息利用命令独立设置，
% 其中命令的名字跟 \emph{key} 相同。两种方式可以交叉使用，并按顺序执行（即后来的设置会覆
% 盖前面的）。以 \texttt{c} 开头的命令跟中文相关，\texttt{e} 开头则为对应的英文。
%
% \DescribeMacro{\rucsetup}
% \cs{rucsetup} 用法与常见 \emph{key=value} 命令相同，如下：
% \begin{latex}
% \rucsetup{
%   key1 = value1,
%   key2 = {a value, with comma},
% }
% % 可以多次调用
% \rucsetup{
%   key3 = value3,
%   key1 = value11, % 覆盖 value1
% }
% \end{latex}
%
% \note[注意：]{\cs{rucsetup} 使用 \pkg{kvoptions} 机制，所以配置项之间不能有空行，
% 否则会报错。}
%
% 大多数命令的使用方法都是： \cs{command}\marg{arg}，例外者将具体指出。这些命令都
% 在示例文档的 \file{data/cover.tex} 中。
%
% \subsubsection{密级}
% \label{sec:setup-secret}
% \DescribeMacro{\secretlevel}
% \DescribeMacro{\secretyear}
% 定义秘密级别和年限，需要打开论文的 \option{secret} 选项。
% \begin{latex}
% \rucsetup{
%   secretyear=10,
%   secretlevel={内部},
% }
% % 以下命令方式与上面的等价：
% \secretyear{10}
% \secretlevel{内部}
% \end{latex}
%
% \subsubsection{论文标题}
% \DescribeMacro{\ctitle}
% \DescribeMacro{\etitle}
% 中英文标题。可以在标题内部使用换行|\\|。
% \begin{latex}
% \rucsetup{
%   ctitle={论文中文题目},
%   etitle={Thesis English Title}
% }
% % 等价：
% \ctitle{论文中文题目}
% \etitle{Thesis English Title}
% \end{latex}
%
% \subsubsection{论文编码}
% \DescribeMacro{\ccodeno}
% 论文编码，参考教务处论文指导手册。
% \begin{latex}
% \rucsetup{
%   ccodeno={RUC-XX-xxxxxx-20yy20zzzz}
% }
% % 等价：
% \ccodeno{RUC-XX-xxxxxx-20yy20zzzz}
% \end{latex}
%
% \subsubsection{作者姓名}
% \DescribeMacro{\cauthor}
% \DescribeMacro{\eauthor}
% 作者姓名。
% \begin{latex}
% \rucsetup{
%   cauthor={中文姓名},
%   eauthor={Name in PinYin}
% }
% % 等价：
% \cauthor{中文姓名}
% \eauthor{Name in PinYin}
% \end{latex}
%
% \subsubsection{申请学位名称}
% \label{sec:degree}
% \DescribeMacro{\cdegree}
% \DescribeMacro{\edegree}
% 学位和专业的设置比想象的要复杂一些：
%
% \begin{longtable}{p{2cm}p{8cm}p{4cm}}
%   \toprule
%   学位类型 & edegree & emajor \\\midrule
%   学术型硕士
%     & 必须为“Master of Art”或“Master of Science”（注意大
%       小写），其中 “哲学、文学、历史学、法学、教育学、艺术学门类，公共
%       管理学科填写“Master of Arts”，其它填写“Master of Science”。
%     & “获得一级学科授权的学科填写一级学科名称，其它填写二级学
%       科名称”。\\\midrule
%   专业型硕士
%     & 专业学位英文名称全称 & %     工程硕士填写工程领域，其它专业学位不填写此项。\\\midrule
%   学术型博士 & Doctor of Philosophy（注意大小写）
%     & 获得一级学科授权的学科填写一级学科名称，其它填写二级学科名称。\\\midrule
%   专业型博士 & 专业学位英文名称全称 & 不填写此项。\\\bottomrule
% \end{longtable}
%
% \begin{latex}
% \rucsetup{
%   cdegree={您要申请什么学位},
%   edegree={degree in English}
% }
% % 等价：
% \cdegree{您要申请什么学位}
% \edegree{degree in English}
% \end{latex}
%
% \subsubsection{学院名称}
% \DescribeMacro{\cdepartment}
% \DescribeMacro{\edepartment}
% 学院名称。
% \begin{latex}
% \rucsetup{
%   cdepartment={学院全称},
%   edepartment={School of CS}
% }
% % 等价：
% \cdepartment{学院全称}
% \edepartment{School of CS}
% \end{latex}
%
% \subsubsection{专业名称}
% \DescribeMacro{\cmajor}
% \DescribeMacro{\emajor}
% 参见第 \ref{sec:degree} 节。
% \begin{latex}
% \rucsetup{
%   cmajor={专业名称},
%   emajor={Major in English}
% }
% % 等价：
% \cmajor{专业名称}
% \emajor{Major in English}
% \end{latex}
%
% \subsubsection{年级学号}
% \DescribeMacro{\cgrade}
% \DescribeMacro{\cstudentid}
% 作者年级、学号。
% \begin{latex}
% \rucsetup{
%   cgrade={20xx级},
%   cstudentid={20xx20yyyy}
% }
% % 等价：
% \cgrade{20xx级}
% \cstudentid{20xx20yyyy}
% \end{latex}
%
% \subsubsection{导师}
% \myentry{导师}
% \DescribeMacro{\csupervisor}
% \DescribeMacro{\esupervisor}
% 直接导师。
% \begin{latex}
% \rucsetup{
%   csupervisor={导师~教授},
%   esupervisor={Supervisor}
% }
% % 等价：
% \csupervisor{导师~教授}
% \esupervisor{Supervisor}
% \end{latex}
%
% \myentry{副导师}
% \DescribeMacro{\cassosupervisor}
% \DescribeMacro{\eassosupervisor}
% 本科生的辅导教师，硕士的副指导教师。
% \begin{latex}
% \rucsetup{
%   cassosupervisor={副导师~副教授},
%   eassosupervisor={2nd Boss}
% }
% % 等价：
% \cassosupervisor{副导师~副教授}
% \eassosupervisor{2nd Boss}
% \end{latex}
%
% \myentry{联合导师}
% \DescribeMacro{\ccosupervisor}
% \DescribeMacro{\ecosupervisor}
% 硕士生联合指导教师，博士生联合导师。
% \begin{latex}
% \rucsetup{
%   ccosupervisor={联合导师~教授},
%   ecosupervisor={3rd Boss}
% }
% % 等价：
% \ccosupervisor{联合导师~教授}
% \ecosupervisor{3rd Boss}
% \end{latex}
%
% \subsubsection{论文成绩}
% \DescribeMacro{\cscore}
% 论文成绩，若手写则设为空。
% \begin{latex}
% \rucsetup{
%   cscore={}
% }
% % 等价：
% \cscore{}
% \end{latex}
%
% \subsubsection{成文日期}
% \DescribeMacro{\cdate}
% \DescribeMacro{\edate}
% 自己指定日期。
% \begin{latex}
% \rucsetup{
%   cdate={中文日期},
%   edate={English Date}
% }
% % 等价：
% \cdate{中文日期}
% \edate{English Date}
% \end{latex}
%
% \subsubsection{摘要}
% \myentry{摘要正文}
% \DescribeEnv{cabstract}
% \DescribeEnv{eabstract}
% \note[说明：]{摘要正文只能用环境命令的形式，不支持 \cs{rucsetup}。}
%
% \begin{latex}
% \begin{cabstract}
%  摘要请写在这里...
% \end{cabstract}
%
% \begin{eabstract}
%  Here comes the abstract in English...
% \end{eabstract}
% \end{latex}
%
% \myentry{关键词}
% \DescribeMacro{\ckeywords}
% \DescribeMacro{\ekeywords}
% 关键词用英文逗号分割写入相应的命令中，模板会解析各关键词并生成符合不同论文格式
% 要求的关键词格式。
% \begin{latex}
% \rucsetup{
%   ckeywords={关键词 1, 关键词 2},
%   ekeywords={keyword 1, keyword 2}
% }
% % 等价：
% \ckeywords{关键词 1, 关键词 2}
% \ekeywords{keyword 1, keyword 2}
% \end{latex}
%
% \myentry{生成封面}
% \DescribeMacro{\makecover}
% 生成封面，包括首页，授权，摘要等。用法：\cs{makecover}\oarg{file}。如果使用授权
% 说明扫描页，将可选参数中指定为扫描得到的 PDF 文件名，例如：
% \begin{latex}
% % 直接生成封面
% \makecover
%
% % 将签字扫描后授权文件 scan-auth.pdf 替换原始页面
% \makecover[scan-auth.pdf]
% \end{latex}
%
% \subsubsection{符号对照表}
% \DescribeEnv{denotation}
% 主要符号表环境，跟 \env{description} 类似，使用方法参见示例文件。带一个可选参数，
% 用来指定符号列的宽度（默认为 4.5cm）。
% \begin{latex}
% \begin{denotation}
%   \item[E] 能量
%   \item[m] 质量
%   \item[c] 光速
% \end{denotation}
% \end{latex}
%
% 如果默认符号列的宽度不满意，可以通过参数来调整：
% \begin{latex}
% \begin{denotation}[2.5cm] % 设置为 2.5cm
%   \item[E] 能量
%   \item[m] 质量
%   \item[c] 光速
% \end{denotation}
% \end{latex}
%
% \subsection{目录和索引表}
% 目录、插图、表格和公式等索引命令分别如下，将其插入到期望的位置即可（带星号的命令表
% 示对应的索引表不会出现在目录中）：
%
% \DescribeMacro{\tableofcontents}
% \DescribeMacro{\listoffigures}
% \DescribeMacro{\listoffigures*}
% \DescribeMacro{\listoftables}
% \DescribeMacro{\listoftables*}
% \DescribeMacro{\listofequations}
% \DescribeMacro{\listofequations*}
% \begin{longtable}{ll}
% \toprule
%   {\heiti 用途} & {\heiti 命令} \\\midrule
% 目录     & \cs{tableofcontents} \\\midrule
% 插图索引 & \cs{listoffigures}   \\
%          & \cs{listoffigures*}  \\\midrule
% 表格索引 & \cs{listoftables}    \\
%          & \cs{listoftables*}   \\\midrule
% 公式索引 & \cs{listofequations} \\
%          & \cs{listofequations*}\\\bottomrule
% \end{longtable}
%
% \LaTeX\ 默认支持插图和表格索引，是通过 \cs{caption} 命令完成的，因此它们必须出
% 现在浮动环境中，否则不被计数。
%
% 如果不想让某个表格或者图片出现在索引里面，那么请使用命令 \cs{caption*}，这
% 个命令不会给表格编号，也就是出来的只有标题文字而没有``表~xx''，``图~xx''，否则
% 索引里面序号不连续就显得不伦不类，这也是 \LaTeX\ 里星号命令默认的规则。
%
% 如果的确想让其编号，但又不想出现在索引中的话，目前模板暂不支持。
%
% 公式索引为本模板扩展，模板扩展了 \pkg{amsmath} 几个内部命令，使得公式编号样式和
% 自动索引功能非常方便。一般来说，你用到的所有数学环境编号都没问题了，这个可以参
% 看示例文档。如果你有个非常特殊的数学环境需要加入公式索引，那么请使
% 用 \cs{equcaption}\marg{编号}。此命令表示 equation caption，带一个参数，即显示
% 在索引中的编号。因为公式与图表不同，我们很少给一个公式附加一个标题，之所以起这
% 么个名字是因为图表就是通过 \cs{caption} 加入索引的，\cs{equcaption} 完全就是为
% 了生成公式列表，不产生什么标题。
%
% 使用方法如下。假如有一个非 equation 数学环境 \texttt{mymath}，只要在其中写一
% 句 \cs{equcaption} 就可以将它加入公式列表。
% \begin{latex}
% \begin{mymath}
%   \label{eq:emc2}\equcaption{\ref{eq:emc2}}
%   E=mc^2
% \end{mymath}
% \end{latex}
%
% \texttt{mymath} 中公式的编号需要自己来做。
%
% 同图表一样，附录中的公式有时候也不希望它跟全文统一编号，而且不希望它出现在公式
% 索引中，目前的解决办法就是利用 \cs{tag*}\marg{公式编号} 来解决。用法很简单，此
% 处不再罗嗦，实例请参看示例文档附录 A 的前两个公式。
%
% \subsection{封底部分}
%
% \subsubsection{致谢}
% \DescribeEnv{acknowledgement}
% 把致谢做成一个环境更好一些，直接往里面写感谢的话就可以啦！
% \begin{latex}
% \begin{acknowledgement}
%   …
%   感谢 \RucThesis，它的存在让我的论文写作轻松自在了许多，让我的论文格式规整漂亮了许多。
% \end{acknowledgement}
% \end{latex}
%
% \subsubsection{附录}
% \DescribeEnv{appendix}
% 所有的附录都插到这里来。因为附录会更改默认的 chapter 属性，而后面的{\heiti 个人简
%   历}又需要恢复，所以实现为环境可以保证全局的属性不受影响。
% \begin{latex}
% \begin{appendix}
%  \input{data/appendix01}
%  \input{data/appendix02}
% \end{appendix}
% \end{latex}
%
% \DescribeEnv{translationbib}
% 本环境用来描述外文资料中的参考文献，例子：
% \begin{latex}
% \begin{translationbib}
%   \item Donald E. Knuth. The \TeX book. Addison-Wesley, 1984. ISBN: 0-201-13448-9
%   \item Paul W. Abrahams, Karl Berry and Kathryn A. Hargreaves. \TeX\ for the
%     Impatient. Addison-Wesley, 1990. ISBN: 0-201-51375-7
%   \item David Salomon. The advanced \TeX book.  New York : Springer, 1995. ISBN:0-387-94556-3
% \end{translationbib}
% \end{latex}
%
% \subsubsection{简历}
% \DescribeEnv{resume}
% 开启个人简历章节，包括个人简历，发表文章，研究成果列表等。每个子项目请
% 用以下对应命令开启：\cs{xxxitem}\marg{subtitle}。
%
% \DescribeMacro{\resumeitem}
% 个人简历，用法：\cs{resumeitem}\{个人简历\}。简历内容部分没有格式要求，正常段
% 落排版。
%
% \DescribeMacro{\researchitem}
% 发表学术论文，用法：\cs{researchitem}\marg{类别}，包括“学术论文”和“研究成果”两
% 个类别。分别用 \env{publications} 和 \env{achievements} 罗列。
%
% \DescribeEnv{publications}
% \DescribeMacro{\publicationskip}
% 用 \env{publications} 环境进行罗列发表的论文。按照学校要求，在学期间发表的学术
% 论文分以下三部分按顺序分别列出，每部分之间空 1 行，序号可连续排列：
% \begin{enumerate}
% \item 已经刊载的学术论文（本人是第一作者，或者导师为第一作者本人是第二作者）
% \item 尚未刊载，但已经接到正式录用函的学术论文（本人为第一作者，或者导师为第一
%   作者本人是第二作者）。
% \item 其他学术论文。可列出除上述两种情况以外的其他学术论文，但必须是已经刊载或
%   者收到正式录用函的论文。
% \end{enumerate}
%
% \env{publications} 环境支持每一部分分别编写，逻辑上更清楚，为了在环境之间支持
% 空行，需要利用 \cs{publicationskip} 控制。示例：
% \begin{latex}
%  \researchitem{发表的学术论文}
%
%  % 1. 已经刊载的学术论文
%  \begin{publications}
%    \item Yang Y, Ren T L, Zhang L T, et al. Miniature microphone with silicon-
%      based ferroelectric thin films. Integrated Ferroelectrics, 2003,
%      52:229-235. (SCI 收录, 检索号:758FZ.)
%    \item 杨轶, 张宁欣, 任天令, 等. 硅基铁电微声学器件中薄膜残余应力的研究. 中国机
%      械工程, 2005, 16(14):1289-1291. (EI 收录, 检索号:0534931 2907.)
%    \item 杨轶, 张宁欣, 任天令, 等. 集成铁电器件中的关键工艺研究. 仪器仪表学报,
%      2003, 24(S4):192-193. (EI 源刊.)
%  \end{publications}
%
%  % 2. 尚未刊载，但已经接到正式录用函的学术论文
%  \begin{publications}[before=\publicationskip,after=\publicationskip]
%    \item Yang Y, Ren T L, Zhu Y P, et al. PMUTs for handwriting recognition. In
%      press. (已被 Integrated Ferroelectrics 录用. SCI 源刊.)
%  \end{publications}
%
%  % 3. 其他学术论文。
%  \begin{publications}
%    \item Wu X M, Yang Y, Cai J, et al. Measurements of ferroelectric MEMS
%      microphones. Integrated Ferroelectrics, 2005, 69:417-429. (SCI 收录, 检索号
%      :896KM)
%    \item 贾泽, 杨轶, 陈兢, 等. 用于压电和电容微麦克风的体硅腐蚀相关研究. 压电与声
%      光, 2006, 28(1):117-119. (EI 收录, 检索号:06129773469)
%    \item 伍晓明, 杨轶, 张宁欣, 等. 基于MEMS技术的集成铁电硅微麦克风. 中国集成电路,
%      2003, 53:59-61.
%  \end{publications}
% \end{latex}
%
% \DescribeEnv{achievements}
% 研究成果用 \cs{researchitem}\{研究成果\} 开启，随后用 \env{achievements} 环
% 境罗列。
%
% 具体用法请参看示例文档 \file{data/resume.tex}。
%
% \subsection{自定义}
% \label{sec:othercmd}
%
% \subsubsection{数学环境}
% \label{sec:math}
% \ructhesis\ 定义了常用的数学环境：
%
% \begin{center}
% \begin{tabular}{*{7}{l}}\toprule
%   axiom & theorem & definition & proposition & lemma & conjecture &\\
%   公理 & 定理 & 定义 & 命题 & 引理 & 猜想 &\\\midrule
%   proof & corollary & example & exercise & assumption & remark & problem \\
%   证明 & 推论 & 例子& 练习 & 假设 & 注释 & 问题\\\bottomrule
% \end{tabular}
% \end{center}
%
% 比如：
% \begin{latex}
% \begin{definition}
%   道千乘之国，敬事而信，节用而爱人，使民以时。
% \end{definition}
% \end{latex}
% 产生（自动编号）：
% \medskip
%
% \noindent\framebox[\linewidth][l]{{\heiti 定义~1.1~~~} % {道千乘之国，敬事而信，节用而爱人，使民以时。}}
%
% \smallskip
% 列举出来的数学环境毕竟是有限的，如果想用\emph{胡说}这样的数学环境，那么可以定义：
% \begin{latex}
% \newtheorem{nonsense}{胡说}[chapter]
% \end{latex}
%
% 然后这样使用：
% \begin{latex}
% \begin{nonsense}
%   契丹武士要来中原夺武林秘笈。—— 慕容博
% \end{nonsense}
% \end{latex}
% 产生（自动编号）：
%
% \medskip
% \noindent\framebox[\linewidth][l]{{\heiti 胡说~1.1~~~} % {契丹武士要来中原夺武林秘笈。—— 慕容博}}
%
% \subsubsection{引用方式}
%
% \DescribeMacro{\inlinecite}
% 学校要求的参考文献引用有两种模式：（1）上标模式。比如``同样的工作有很
% 多$^{[1,2]}$\ldots''。（2）正文模式。比如``文[3] 中详细说明了\ldots''。其中上标
% 模式使用远比正文模式频繁，所以为了符合使用习惯，上标模式仍然用常规
% 的 \cs{cite}\marg{key}，而 \cs{inlinecite}\marg{key} 则用来生成正文模式。
%
% 关于参考文献模板推荐使用 \BibTeX，关于中文参考文献需要额外增加一个 Entry:
% \texttt{lang}，将其设置为 \texttt{zh} 用来指示此参考文献为中文，以
% 便 \file{ructhesis.bst} 处理。如：
% \begin{latex}
% @INPROCEEDINGS{cnproceed,
%   author    = {王重阳 and 黄药师 and 欧阳峰 and 洪七公 and 段皇帝},
%   title     = {武林高手从入门到精通},
%   booktitle = {第~$N$~次华山论剑},
%   year      = 2006,
%   address   = {西安, 中国},
%   month     = sep,
%   lang      = "zh",
% }
%
% @ARTICLE{cnarticle,
%   AUTHOR  = "贾宝玉 and 林黛玉 and 薛宝钗 and 贾探春",
%   TITLE   = "论刘姥姥食量大如牛之现实意义",
%   JOURNAL = "红楼梦杂谈",
%   PAGES   = "260--266",
%   VOLUME  = "224",
%   YEAR    = "1800",
%   LANG    = "zh",
% }
% \end{latex}
%
% 注意如果不需要引用参考文献，请删除 \file{main.tex} 中 \cs{bibliography} 开头的两行，
% 以避免可能的编译错误。
%
% \subsubsection{列表环境}
% \DescribeEnv{itemize}
% \DescribeEnv{enumerate}
% \DescribeEnv{description}
% 为了适合中文习惯，模板将这三个常用的列表环境用 \pkg{enumitem} 进行了纵向间距压
% 缩。一方面清除了多余空间，另一方面用户可以自己指定列表环境的样式（如标签符号，
% 缩进等）。细节请参看 \pkg{enumitem} 文档，此处不再赘述。
%
% \subsection{其它}
% 模板的配置文件 \file{ructhesis.cfg} 中定义了很多固定词汇，一般无须修改。如果有特殊需求，
% 推荐在导言区使用 \cs{renewcommand}。
%
% \section{致谢}
% \label{sec:thanks}
% 本模板及文档均修改自 \textsc{ThuThesis}, 感谢薛瑞尼同学提供的 \LaTeX 模板!
%
% \StopEventually{\PrintChanges\PrintIndex}
% \clearpage
%
% \section{实现细节}
%
% \subsection{基本信息}
%    \begin{macrocode}
%<cls>\NeedsTeXFormat{LaTeX2e}[1999/12/01]
%<cls>\ProvidesClass{ructhesis}
%<cfg>\ProvidesFile{ructhesis.cfg}
%<cls|cfg>[2017/05/09 0.0.1 Renmin University of China Thesis Template]
%    \end{macrocode}
%
% \subsection{定义选项}
% \label{sec:defoption}
% 定义论文类型以及是否涉密
% \changes{thuthesis v2.4}{2006/04/14}{添加模板名称命令。}
% \changes{thuthesis v2.5}{2006/05/19}{增加本科论文的提交选项 submit。}
% \changes{thuthesis v2.5.1}{2006/05/24}{如果没有设置格式选项，报错。}
% \changes{thuthesis v2.5.1}{2006/05/26}{submit 只能由本科用。}
% \changes{thuthesis v2.5.3}{2006/06/03}{submit 选项的一个笔误。}
% \changes{thuthesis v3.0}{2007/05/12}{删除 submit 选项。}
% \changes{thuthesis v4.6}{2011/04/26}{增加 postdoctor 选项。}
% \changes{thuthesis v4.8}{2014/11/25}{v4.7曾经想发布，但是一直没有做，于是就被跳过了，算是造一个段子吧。}
% \changes{thuthesis v4.8.1}{2014/12/09}{按照 CTAN 的要求整理一下文件。}
% \changes{ructhesis v0.0.1}{2017/05/09}{删除 postdoctor 选项。}
%    \begin{macrocode}
%<*cls>
\hyphenation{Ruc-Thesis}
\def\ructhesis{\textsc{RucThesis}}
\def\version{0.0.1}

\RequirePackage{kvoptions}
\SetupKeyvalOptions{
  family=ruc,
  prefix=ruc@,
  setkeys=\kvsetkeys}
%    \end{macrocode}
%
% 用 \pkg{kvoptions} 的 key=value 方式来设置论文类型。
% \changes{thuthesis v5.0.0}{2015/12/13}{使用 \pkg{kvoptions} 简化选项 type。}
%    \begin{macrocode}
\newif\ifruc@bachelor
\newif\ifruc@master
\newif\ifruc@doctor
\define@key{ruc}{type}{%
  \ruc@bachelorfalse
  \ruc@masterfalse
  \ruc@doctorfalse
  \expandafter\csname ruc@#1true\endcsname}
\def\ruc@deprecated@type@option{%
  \kvsetkeys{ruc}{type=\CurrentOption} % for compatability.
  \ClassError{ructhesis}{Option '\CurrentOption' is deprecated, \MessageBreak
                         please use 'type=\CurrentOption' instead}{}}
\DeclareVoidOption{bachelor}{\ruc@deprecated@type@option}
\DeclareVoidOption{master}{\ruc@deprecated@type@option}
\DeclareVoidOption{doctor}{\ruc@deprecated@type@option}
%    \end{macrocode}
%
% 论文是否保密。
%    \begin{macrocode}
\DeclareBoolOption{secret}
%    \end{macrocode}
%
% 目录中英文是否用 Arial 字体（默认关闭）。
%    \begin{macrocode}
\DeclareBoolOption{arialtoc}
%    \end{macrocode}
%
% 章节标题中的英文是否用 Arial 字体（默认打开）。
%    \begin{macrocode}
\DeclareBoolOption{arialtitle}
%    \end{macrocode}
%
% \option{raggedbottom} 选项（默认打开）
% \changes{thuthesis v4.8}{2013/03/05}{增加 noraggedbottom 选项。}
% \changes{thuthesis v5.0.0}{2015/12/13}{norggedbottom 选项修改为 raggedbottom。}
%    \begin{macrocode}
\DeclareBoolOption{raggedbottom}
%    \end{macrocode}
%
% 在脚注标记中使用 \pkg{pifont} 的带圈数字（默认关闭）
%    \begin{macrocode}
\DeclareBoolOption{pifootnote}
%    \end{macrocode}
%
% 双面打印选项（默认关闭）
%    \begin{macrocode}
\DeclareBoolOption{twosideprint}
%    \end{macrocode}
%
% 将选项传递给 \pkg{ctexbook}。
%    \begin{macrocode}
\DeclareDefaultOption{\PassOptionsToClass{\CurrentOption}{ctexbook}}
%    \end{macrocode}
%
% \changes{thuthesis v2.5.1}{2006/05/24}{研究生院目录要 times，而教务处要 arial。}
% \changes{thuthesis v2.5.1}{2006/05/26}{本科 openright，研究生 openany。}
% \changes{thuthesis v3.1}{2007/10/09}{本科的目录又不要 arial 字体了。}
% \changes{thuthesis v4.8}{2013/05/29}{添加 nocap 选项，恢复默认标题样式，模板会进一步定制。}
% 打开默认选项。
%    \begin{macrocode}
\kvsetkeys{ruc}{%
  raggedbottom}
%    \end{macrocode}
%
% 解析用户传递过来的选项，并加载 \pkg{ctexbook}。
%    \begin{macrocode}
\ProcessKeyvalOptions*
%    \end{macrocode}
%
% 使用 \XeTeX\ 引擎时，\pkg{fontspec} 宏包会被 \pkg{xeCJK} 自动调用。传递
% 给 \pkg{fontspec} 宏包 \option{no-math} 选项，避免部分数学符号字体自动调整
% 为 CMR。其他引擎下没有这个问题，这一行会被无视。
%    \begin{macrocode}
\PassOptionsToPackage{no-math}{fontspec}
%    \end{macrocode}
%
% \changes{thuthesis v5.3.1}{2016/03/20}{使用 \CTeX\ 默认中文字体配置，支持不同引擎。}
% 使用 \pkg{ctexbook} 类，优于调用 \pkg{ctex} 宏包。
%    \begin{macrocode}
\LoadClass[a4paper,openany,UTF8,zihao=-4,scheme=plain]{ctexbook}
%    \end{macrocode}
%
% 用户至少要提供一个选项，指定论文类型。
%    \begin{macrocode}
\ifruc@bachelor\relax\else
  \ifruc@master\relax\else
    \ifruc@doctor\relax\else
      \ClassError{ructhesis}%
                 {Please specify thesis type in option: \MessageBreak
                  type=[bachelor | master | doctor]}{}
    \fi
  \fi
\fi
%    \end{macrocode}
%
% \subsection{装载宏包}
% \label{sec:loadpackage}
%
% 引用的宏包和相应的定义。
%    \begin{macrocode}
\RequirePackage{etoolbox}
\RequirePackage{ifxetex}
\RequirePackage{xparse}
%    \end{macrocode}
%
% \AmSTeX\ 宏包，用来排出更加漂亮的公式。
% \changes{thuthesis v4.8}{2013/03/02}{no need to load amssymb since we use txfonts.}
%    \begin{macrocode}
\RequirePackage{amsmath}
%    \end{macrocode}
%
% WASY2 符号。
% \changes{ructhesis v0.0.1}{2017/05/09}{使用 \pkg{wasysym} 符号。}
%    \begin{macrocode}
\RequirePackage{wasysym}
%    \end{macrocode}
%
% \pkg{newtx} 设置 Times New Roman，Helvetica。
% \changes{thuthesis v3.1}{2007/06/16}{replace \pkg{mathptmx} with \pkg{txfonts}.}
% \changes{thuthesis v5.2.1}{2016/01/14}{使用 \pkg{newtx} 替换 \pkg{txfonts}。}
% \changes{thuthesis v5.2.2}{2016/02/01}{不希望 \pkg{newtx} 修改 \cs{@makefnmark}。 }
%    \begin{macrocode}
\RequirePackage[defaultsups]{newtxtext}
\RequirePackage{newtxmath}
%    \end{macrocode}
%
% \pkg{newtx} 的 Mono 字体虽然很好看，但在论文中不常见。学校虽未要求 Mono 字体，
% 还是选择常见的 Courier 字体。由于比较新的实现 \TeX\ Gyre Cursor 会修
% 改\cs{bfdefault}，导致中文加粗出问题，所以选用标准 \pkg{courier}。
% \changes{thuthesis v5.3.2}{2016/5/24}{替换 \pkg{tgcursor} 为 \pkg{courier}。}
%    \begin{macrocode}
\RequirePackage{courier}
%    \end{macrocode}
%
% 图形支持宏包。
%    \begin{macrocode}
\RequirePackage{graphicx}
%    \end{macrocode}
%
% 并排图形。\pkg{subfigure}、\pkg{subfig} 已经不再推荐，用新的 \pkg{subcaption}。
% 浮动图形和表格标题样式。\pkg{caption2} 已经不推荐使用，采用新的 \pkg{caption}。
%    \begin{macrocode}
\RequirePackage[labelformat=simple]{subcaption}
%    \end{macrocode}
%
% \pkg{pdfpages} 宏包便于我们插入扫描后的授权页和声明页 PDF 文档。
%    \begin{macrocode}
\RequirePackage{pdfpages}
\includepdfset{fitpaper=true}
%    \end{macrocode}
%
% 更好的列表环境。
% \changes{thuthesis v2.6.2}{2006/06/18}{去掉 \pkg{paralist} 的 \option{newitem} 和
% \option{newenum} 选项，因为默认是打开的。}
% \changes{thuthesis v2.6.4}{2006/10/23}{增加 \option{neverdecrease} 选项。}
% \changes{thuthesis v5.0.0}{2012/12/13}{删除 \pkg{paralist} 选项。}
% \changes{thuthesis v5.2.2}{2016/01/31}{利用 \pkg{environ} 的 \cs{Collect@Body}。}
%    \begin{macrocode}
\RequirePackage[shortlabels]{enumitem}
\RequirePackage{environ}
%    \end{macrocode}
%
% 禁止 \LaTeX 自动调整多余的页面底部空白，并保持脚注仍然在底部。
% 脚注按页编号。
%    \begin{macrocode}
\ifruc@raggedbottom
  \RequirePackage[bottom,perpage,hang]{footmisc}
  \raggedbottom
\else
  \RequirePackage[perpage,hang]{footmisc}
\fi
%    \end{macrocode}
%
%    \begin{macrocode}
\ifruc@pifootnote
  \RequirePackage{pifont}
\fi
%    \end{macrocode}
% 利用 \pkg{CJKfntef} 实现汉字的下划线和盒子内两段对齐，并可以避免
% \cs{makebox}\oarg{width}\oarg{s} 可能产生的 underful boxes。
%    \begin{macrocode}
\RequirePackage{CJKfntef}
%    \end{macrocode}
%
% \changes{thuthesis v4.8}{2013/05/28}{在 CJK 模式下用 \pkg{CJKspace} 保留中英文间空格。}
% \changes{thuthesis v5.0.0}{2015/04/17}{固定字体设置，同时改善与 \pkg{ctex} 兼容性。}
% \changes{thuthesis v5.2.1}{2016/01/14}{使用 \pkg{newtx} 字体。}
% \changes{thuthesis v5.3.1}{2016/03/20}{\pkg{ctex} 默认加载 \pkg{CJKspace}。}
% \changes{thuthesis v5.3.1}{2016/03/20}{几乎没人主动安装 Arial 字体。}
%
% 定理类环境宏包，其中 \pkg{amsmath} 选项用来兼容 \AmSTeX\ 的宏包
%    \begin{macrocode}
\RequirePackage[amsmath,thmmarks,hyperref]{ntheorem}
%    \end{macrocode}
%
% 表格控制
% \changes{thuthesis v2.6}{2006/06/09}{增加 \pkg{longtable}。}
% \changes{ructhesis v0.0.1}{2017/05/09}{增加 \pkg{colortbl}。}
%    \begin{macrocode}
\RequirePackage{array}
\RequirePackage{longtable}
\RequirePackage{colortbl}
%    \end{macrocode}
%
% 使用三线表：\cs{toprule}，\cs{midrule}，\cs{bottomrule}。
%    \begin{macrocode}
\RequirePackage{booktabs}
%    \end{macrocode}
%
% 参考文献引用宏包。
%    \begin{macrocode}
\RequirePackage[numbers,super,sort&compress]{natbib}
%    \end{macrocode}
%
% 删除默认模板（\file{book.cls}）在章之间引入的垂直间隔。要放在 \pkg{hyperref}
% 之前。
%    \begin{macrocode}
\patchcmd{\@chapter}{\addtocontents{lof}{\protect\addvspace{10\p@}}}{}{}{} % lof
\patchcmd{\@chapter}{\addtocontents{lot}{\protect\addvspace{10\p@}}}{}{}{} % lot
%    \end{macrocode}
% 生成有书签的 pdf 及其开关，请结合 gbk2uni 避免书签乱码。
% \changes{thuthesis v2.6}{2006/06/09}{去除 hyperref 选项，等待全局传递。}
% \changes{thuthesis v5.2.2}{2016/01/25}{目录中标题和页码都是链接。}
%    \begin{macrocode}
\RequirePackage{hyperref}
\ifxetex
  \hypersetup{%
    CJKbookmarks=true}
\else
  \hypersetup{%
    unicode=true,
    CJKbookmarks=false}
\fi
\hypersetup{%
  linktoc=all,
  bookmarksnumbered=true,
  bookmarksopen=true,
  bookmarksopenlevel=1,
  breaklinks=true,
  colorlinks=false,
  plainpages=false,
  pdfborder=0 0 0}
%    \end{macrocode}
%
% dvips 模式下网址断字有问题，请手工加载 \pkg{breakurl} 宏包解决之。
%
% 设置 url 样式，与上下文一致
%    \begin{macrocode}
\urlstyle{same}
%    \end{macrocode}
%
%
% \subsection{页面设置}
% \label{sec:layout}
% 本来这部分应该是最容易设置的，但根据格式规定出来的结果跟学校的 WORD 样例相差很
% 大，所以只能微调。
% \changes{thuthesis v2.4}{2006/04/14}{把页面尺寸写入 dvi，避免有的用户通
%   过 dvips 不指定页面类型而得到古怪的结果。}
% \changes{thuthesis v4.5.2}{2010/09/19}{研究生页面边距由 3.2cm 改为 3cm。}
% \changes{thuthesis v4.7}{2012/05/29}{修改本科生页脚间距与样例基本一致。}
% \changes{thuthesis v5.0.0}{2015/03/10}{不再将页面尺寸写入 dvi，因为已不支持 dvips，
% 而该方案会使得在使用 tikzexternalize 时外部 PDF 图片 BBox 不对。}
% \changes{thuthesis v5.0.0}{2015/12/14}{用 \pkg{geometry} 简化设置。}
% \changes{ructhesis v0.0.1}{2017/05/09}{修改本科论文页面边距，增加双面打印时的装订线边距。}
%    \begin{macrocode}
\RequirePackage{geometry}
\geometry{
  a4paper, % 210 * 297mm
  hcentering,
  ignoreall,
  nomarginpar}
\ifruc@bachelor
\geometry{
  left=25mm,
  headheight=11mm,
  headsep=5mm,
  textheight=235mm,
  bottom=31mm,
  footskip=11mm}
\ifruc@twosideprint\geometry{
  inner=28mm,
  outer=22mm}
\fi
\else
\geometry{
  left=30mm,
  headheight=5mm,
  headsep=5mm,
  textheight=237mm,
  bottom=29mm,
  footskip=6mm}
\fi
%    \end{macrocode}
%
% 利用 \pkg{fancyhdr} 设置页眉页脚。
%    \begin{macrocode}
\RequirePackage{fancyhdr}
%</cls>
%    \end{macrocode}
%
% \subsection{主文档格式}
% \label{sec:mainbody}
%
% \subsubsection{Three matters}
% \begin{macro}{\cleardoublepage}
% 对于 \textsl{openright} 选项，必须保证章首页右开，且如果前章末页无内容须
% 清空其页眉页脚。
%    \begin{macrocode}
%<*cls>
\let\ruc@cleardoublepage\cleardoublepage
\newcommand{\ruc@clearemptydoublepage}{%
  \clearpage{\pagestyle{ruc@empty}\ruc@cleardoublepage}}
\let\cleardoublepage\ruc@clearemptydoublepage
%    \end{macrocode}
% \end{macro}
%
% \begin{macro}{\frontmatter}
% \begin{macro}{\mainmatter}
% \begin{macro}{\backmatter}
% 我们的单面和双面模式与常规的不太一样。
% \changes{thuthesis v2.5.1}{2006/05/23}{本科正文之后页码即用罗马数字，研究生不变。}
% \changes{thuthesis v2.5.3}{2006/06/03}{第一章永远右开。}
% \changes{thuthesis v4.4}{2008/05/30}{本科正文后的页码延续前面的阿拉伯数字，不再用罗马数
% 字。}
% \changes{thuthesis v4.4}{2008/05/30}{本科取消了所有页眉。}
%    \begin{macrocode}
\renewcommand\frontmatter{%
  \if@openright\cleardoublepage\else\clearpage\fi
  \@mainmatterfalse
  \pagenumbering{Roman}
  \pagestyle{ruc@logo}}
\renewcommand\mainmatter{%
  \if@openright\cleardoublepage\else\clearpage\fi
  \@mainmattertrue
  \pagenumbering{arabic}
  \ifruc@bachelor\pagestyle{ruc@logo}\else\pagestyle{ruc@headings}\fi}
\renewcommand\backmatter{%
  \if@openright\cleardoublepage\else\clearpage\fi
  \@mainmattertrue}
%</cls>
%    \end{macrocode}
% \end{macro}
% \end{macro}
% \end{macro}
%
% \subsubsection{字体}
% \label{sec:font}
% \begin{macro}{\normalsize}
% 正文小四号 (12bp) 字，行距为固定值 20 bp。
%    \begin{macrocode}
%<*cls>
\renewcommand\normalsize{%
  \@setfontsize\normalsize{12bp}{20bp}%
  \abovedisplayskip=20bp \@plus 2bp \@minus 2bp
  \abovedisplayshortskip=20bp \@plus 2bp \@minus 2bp
  \belowdisplayskip=\abovedisplayskip
  \belowdisplayshortskip=\abovedisplayshortskip}
%    \end{macrocode}
% \end{macro}
%
% WORD 中的字号对应该关系如下（1bp = 72.27/72 pt）:
% \begin{center}
% \begin{tabular}{llll}
% \toprule
% 初号 & 42bp & 14.82mm & 42.1575pt \\
% 小初 & 36bp & 12.70mm & 36.135 pt \\
% 一号 & 26bp & 9.17mm & 26.0975pt \\
% 小一 & 24bp & 8.47mm & 24.09pt \\
% 二号 & 22bp & 7.76mm & 22.0825pt \\
% 小二 & 18bp & 6.35mm & 18.0675pt \\
% 三号 & 16bp & 5.64mm & 16.06pt \\
% 小三 & 15bp & 5.29mm & 15.05625pt \\
% 四号 & 14bp & 4.94mm & 14.0525pt \\
% 小四 & 12bp & 4.23mm & 12.045pt \\
% 五号 & 10.5bp & 3.70mm & 10.59375pt \\
% 小五 & 9bp & 3.18mm & 9.03375pt \\
% 六号 & 7.5bp & 2.56mm & \\
% 小六 & 6.5bp & 2.29mm & \\
% 七号 & 5.5bp & 1.94mm & \\
% 八号 & 5bp & 1.76mm & \\\bottomrule
% \end{tabular}
% \end{center}
%
% \begin{macro}{\ruc@def@fontsize}
% \changes{thuthesis v2.6.2}{2006/06/18}{引入此命令重新定义字号。}
% 根据习惯定义字号。用法：
%
% \cs{ruc@def@fontsize}\marg{字号名称}\marg{磅数}
%
% 避免了字号选择和行距的紧耦合。所有字号定义时为单倍行距，并提供选项指定行距倍数。
% \changes{thuthesis v5.2.3}{2016/02/13}{改写字体定义命令。}
%    \begin{macrocode}
\def\ruc@def@fontsize#1#2{%
  \expandafter\newcommand\csname #1\endcsname[1][1.3]{%
    \fontsize{#2}{##1\dimexpr #2}\selectfont}}
%    \end{macrocode}
% \end{macro}
%
% \begin{macro}{\chuhao}
% \begin{macro}{\xiaochu}
% \begin{macro}{\yihao}
% \begin{macro}{\xiaoyi}
% \begin{macro}{\erhao}
% \begin{macro}{\xiaoer}
% \begin{macro}{\sanhao}
% \begin{macro}{\xiaosan}
% \begin{macro}{\sihao}
% \begin{macro}{\banxiaosi}
% \begin{macro}{\xiaosi}
% \begin{macro}{\dawu}
% \begin{macro}{\wuhao}
% \begin{macro}{\xiaowu}
% \begin{macro}{\liuhao}
% \begin{macro}{\xiaoliu}
% \begin{macro}{\qihao}
% \begin{macro}{\bahao}
% 一组字号定义。TODO：用 \cs{zihao} 替代。
%    \begin{macrocode}
\ruc@def@fontsize{chuhao}{42bp}
\ruc@def@fontsize{xiaochu}{36bp}
\ruc@def@fontsize{yihao}{26bp}
\ruc@def@fontsize{xiaoyi}{24bp}
\ruc@def@fontsize{erhao}{22bp}
\ruc@def@fontsize{xiaoer}{18bp}
\ruc@def@fontsize{sanhao}{16bp}
\ruc@def@fontsize{xiaosan}{15bp}
\ruc@def@fontsize{sihao}{14bp}
\ruc@def@fontsize{banxiaosi}{13bp}
\ruc@def@fontsize{xiaosi}{12bp}
\ruc@def@fontsize{dawu}{11bp}
\ruc@def@fontsize{wuhao}{10.5bp}
\ruc@def@fontsize{xiaowu}{9bp}
\ruc@def@fontsize{liuhao}{7.5bp}
\ruc@def@fontsize{xiaoliu}{6.5bp}
\ruc@def@fontsize{qihao}{5.5bp}
\ruc@def@fontsize{bahao}{5bp}
%</cls>
%    \end{macrocode}
% \end{macro}
% \end{macro}
% \end{macro}
% \end{macro}
% \end{macro}
% \end{macro}
% \end{macro}
% \end{macro}
% \end{macro}
% \end{macro}
% \end{macro}
% \end{macro}
% \end{macro}
% \end{macro}
% \end{macro}
% \end{macro}
% \end{macro}
% \end{macro}
%
%
% \subsubsection{页眉页脚}
% \label{sec:headerfooter}
%
% 定义页眉和页脚。
% \begin{macro}{\ps@ruc@empty}
% \begin{macro}{\ps@ruc@plain}
% \begin{macro}{\ps@ruc@headings}
% \begin{macro}{\ps@ruc@logo}
% \changes{thuthesis v2.0}{2005/12/18}{以前的太乱了，重新整理过清晰多了。}
% \changes{thuthesis v2.1}{2006/03/01}{彻底放弃 fancyhdr，定义自己的样式。}
% \changes{thuthesis v2.5}{2006/05/13}{本科的奇偶页眉不同。}
% \changes{thuthesis v2.5}{2006/05/20}{增加 empty 页面样式。}
% \changes{thuthesis v4.7}{2012/05/29}{本科页码用小五号字。}
% \changes{thuthesis v5.0.0}{2015/12/20}{利用 \pkg{fancyhdr} 设置页眉页脚。}
% \changes{ructhesis v0.0.1}{2017/05/09}{本科增加人大校徽页眉。}
% 定义四种页眉页脚格式：
% \begin{itemize}
% \item \texttt{ruc@empty}：页眉页脚都没有
% \item \texttt{ruc@plain}：只显示页脚的页码。\cs{chapter} 自动调用
% \cs{thispagestyle\{ruc@plain\}}。
% \item \texttt{ruc@headings}：页眉页脚同时显示
% \item \texttt{ruc@logo}：页眉为校徽
% \end{itemize}
%    \begin{macrocode}
%<*cls>
\fancypagestyle{ruc@empty}{%
  \fancyhf{}
  \renewcommand{\headrulewidth}{0pt}
  \renewcommand{\footrulewidth}{0pt}}
\fancypagestyle{ruc@cover}{%
	\fancyhead[C]{\includegraphics[width=4.13cm]{figures/ruc-whole-logo.eps}}
	\fancyfoot{}
	\renewcommand{\headrulewidth}{0.4pt}
	\renewcommand{\footrulewidth}{0pt}}
\fancypagestyle{ruc@plain}{%
  \fancyhead{}
  \fancyfoot[C]{\xiaowu 第 \thepage 页}
  \renewcommand{\headrulewidth}{0pt}
  \renewcommand{\footrulewidth}{0pt}}
\fancypagestyle{ruc@headings}{%
  \fancyhead{}
  \fancyhead[C]{\wuhao\normalfont\leftmark}
  \fancyfoot{}
  \fancyfoot[C]{\wuhao 第 \thepage 页}
  \renewcommand{\headrulewidth}{0.4pt}
  \renewcommand{\footrulewidth}{0pt}}
\fancypagestyle{ruc@logo}{%
  \fancyhead{}
  \fancyhead[C]{\includegraphics[width=4.13cm]{figures/ruc-whole-logo.eps}}
  \fancyfoot{}
  \fancyfoot[C]{\wuhao 第 \thepage 页}
  \renewcommand{\headrulewidth}{0.4pt}
  \renewcommand{\footrulewidth}{0pt}}
%</cls>
%    \end{macrocode}
% \end{macro}
% \end{macro}
% \end{macro}
% \end{macro}
%
% \subsubsection{段落}
% \label{sec:paragraph}
%
% 全文首行缩进 2 字符，标点符号用全角
%    \begin{macrocode}
%<*cls>
\ctexset{%
  punct=quanjiao,
  space=auto,
  autoindent=true}
%    \end{macrocode}
%
% 利用 \pkg{enumitem} 命令调整默认列表环境间的距离，以符合中文习惯。
% \changes{thuthesis v2.5.2}{2006/06/01}{更改默认列表距离。}
%    \begin{macrocode}
\setlist{nosep}
%</cls>
%    \end{macrocode}
%
%
% \subsubsection{脚注}
% \label{sec:footnote}
% 脚注符合中文习惯，数字带圈。
% \changes{thuthesis v2.1}{2006/03/01}{让脚注它悬挂起来，而且中文中用上标，脚注中用正体。}
% \changes{thuthesis v2.5}{2006/05/13}{修正 minipage 中的脚注。}
% \begin{macro}{\ruc@textcircled}
% \changes{thuthesis v2.5.1}{2006/05/21}{脚注编号使用 \cs{textcircled} 命令，每页允许至多 99 个。}
% \changes{thuthesis v5.2.2}{2016/02/01}{脚注编号每页允许至多 9 个。}
% 生成带圈的脚注数字，最多处理到 10。
%    \begin{macrocode}
%<*cls>
\def\ruc@textcircled#1{%
  \ifnum\value{#1} >9
    \ClassError{ructhesis}%
      {Too many footnotes in this page.}{Keep footnote less than 10.}
  \fi
  \ifruc@pifootnote%
    \ding{\the\numexpr\value{#1}+171\relax}%
  \else%
    \textcircled{\xiaoliu\arabic{#1}}%
  \fi}
\renewcommand{\thefootnote}{\ruc@textcircled{footnote}}
\renewcommand{\thempfootnote}{\ruc@textcircled{mpfootnote}}
%    \end{macrocode}
% \end{macro}
%
% 定义脚注分割线，字号（宋体小五），以及悬挂缩进（1.5字符）。
%    \begin{macrocode}
\def\footnoterule{\vskip-3\p@\hrule\@width0.3\textwidth\@height0.4\p@\vskip2.6\p@}
\let\ruc@footnotesize\footnotesize
\renewcommand\footnotesize{\ruc@footnotesize\xiaowu[1.5]}
\footnotemargin1.5em\relax
%    \end{macrocode}
%
% \cs{@makefnmark} 默认是上标样式，而在脚注部分要求为正文大小。利用\cs{patchcmd}
% 动态调整 \cs{@makefnmark} 的定义。
% \changes{thuthesis v2.6}{2006/06/09}{脚注改成 1.5 倍行距，漂亮。}
% \changes{thuthesis v5.2.2}{2016/02/01}{基于 \pkg{footmisc} 来设置不同位置 footnote
% marker 样式。}
%    \begin{macrocode}
\let\ruc@makefnmark\@makefnmark
\def\ruc@@makefnmark{\hbox{{\normalfont\@thefnmark}}}
\pretocmd{\@makefntext}{\let\@makefnmark\ruc@@makefnmark}{}{}
\apptocmd{\@makefntext}{\let\@makefnmark\ruc@makefnmark}{}{}
%</cls>
%    \end{macrocode}
%
%
% \subsubsection{数学相关}
% \label{sec:equation}
% 允许太长的公式断行、分页等。
%    \begin{macrocode}
%<*cls>
\allowdisplaybreaks[4]
\renewcommand\theequation{\ifnum \c@chapter>\z@ \thechapter-\fi\@arabic\c@equation}
%    \end{macrocode}
%
% 公式距前后文的距离由 4 个参数控制，参见 \cs{normalsize} 的定义。
%
% \changes{thuthesis v2.5.1}{2006/05/24}{本科公式编号前添加\textbf{公式}二字。需要修 \pkg{amsmath} 极其深的一个命令。}
% \changes{thuthesis v2.5.1}{2006/05/24}{教务处居然要本科论文公式全文编号！}
% \changes{thuthesis v2.5.2}{2006/05/29}{上一个版本忘了把研究生的公式编号排除。}
% \changes{thuthesis v3.0}{2007/05/12}{本科公式又要取消全文统一编号了。}
% 本科的公式编号要求很诡异，不得不修改 \pkg{amsmath} 中很深的一个命令 \cs{tagform@}。
% \changes{thuthesis v2.6.2}{2006/06/19}{根据不同论文格式显示不同公式编号，并自动加入索引。}
% \changes{thuthesis v4.2}{2008/01/23}{\cs{eqref} 加括号。}
% 同时为了让 \pkg{amsmath} 的 \cs{tag*} 命令得到正确的格式，我们必须修改这些代
% 码。\cs{make@df@tag} 是定义 \cs{tag*} 和 \cs{tag} 内部命令的。
% \cs{make@df@tag@@} 处理 \cs{tag*}，我们就改它！
% \begin{latex}
% \def\make@df@tag{\@ifstar\make@df@tag@@\make@df@tag@@@}
% \def\make@df@tag@@#1{%
%   \gdef\df@tag{\maketag@@@{#1}\def\@currentlabel{#1}}}
% \end{latex}
% \changes{thuthesis v4.4}{2008/05/30}{本科论文终于去掉了\textbf{公式}二字。}
% \changes{thuthesis v4.4.4}{2008/06/12}{修复了一个从 v4.3 升级到 v4.4 过程中的丢失公式索引的 bug，原修改代码保留备忘。}
% \changes{thuthesis v5.2.3}{2016/02/13}{安全注释本科公式部分。}
%    \begin{macrocode}
\def\make@df@tag{\@ifstar\ruc@make@df@tag@@\make@df@tag@@@}
\def\ruc@make@df@tag@@#1{\gdef\df@tag{\ruc@maketag{#1}\def\@currentlabel{#1}}}
\iffalse
\ifruc@bachelor
  \def\ruc@maketag#1{\maketag@@@{%
    (\ignorespaces\text{\equationname\hskip0.5em}#1\unskip\@@italiccorr)}}
  \def\tagform@#1{\maketag@@@{%
    (\ignorespaces\text{\equationname\hskip0.5em}#1\unskip\@@italiccorr)\equcaption{#1}}}
\fi
\fi
\def\ruc@maketag#1{\maketag@@@{(\ignorespaces #1\unskip\@@italiccorr)}}
\def\tagform@#1{\maketag@@@{(\ignorespaces #1\unskip\@@italiccorr)\equcaption{#1}}}
%    \end{macrocode}
% 修改 \cs{tagform} 会影响 \cs{eqref}。
%    \begin{macrocode}
\renewcommand{\eqref}[1]{\textup{(\ref{#1})}}
%    \end{macrocode}
%
% 定理标题使用黑体，正文使用宋体，冒号隔开。
% \changes{thuthesis v2.6.2}{2006/06/17}{增加问题和猜想两个数学环境。}
% \changes{thuthesis v4.2}{2008/03/07}{调整证明环境的编号和结尾的方块。}
% \changes{thuthesis v5.0.0}{2015/04/18}{修正定理字样为黑体 (\#104)。}
%    \begin{macrocode}
\theorembodyfont{\rmfamily\songti}
\theoremheaderfont{\rmfamily\heiti}
%</cls>
%<*cfg>
\theoremsymbol{\ensuremath{\square}}
\newtheorem*{proof}{证明}
\theoremstyle{plain}
\theoremsymbol{}
\theoremseparator{：}
\newtheorem{assumption}{假设}[chapter]
\newtheorem{definition}{定义}[chapter]
\newtheorem{proposition}{命题}[chapter]
\newtheorem{lemma}{引理}[chapter]
\newtheorem{theorem}{定理}[chapter]
\newtheorem{axiom}{公理}[chapter]
\newtheorem{corollary}{推论}[chapter]
\newtheorem{exercise}{练习}[chapter]
\newtheorem{example}{例}[chapter]
\newtheorem{remark}{注释}[chapter]
\newtheorem{problem}{问题}[chapter]
\newtheorem{conjecture}{猜想}[chapter]
%</cfg>
%    \end{macrocode}
%
% \subsubsection{浮动对象以及表格}
% \label{sec:float}
% 设置浮动对象和文字之间的距离
% \changes{thuthesis v2.6}{2006/06/09}{增加 \cs{floatsep}，\cs{@fptop}，\cs{@fpsep} 和 \cs{@fpbot}。}
%    \begin{macrocode}
%<*cls>
\setlength{\floatsep}{20bp \@plus4pt \@minus1pt}
\setlength{\intextsep}{20bp \@plus4pt \@minus2pt}
\setlength{\textfloatsep}{20bp \@plus4pt \@minus2pt}
\setlength{\@fptop}{0bp \@plus1.0fil}
\setlength{\@fpsep}{12bp \@plus2.0fil}
\setlength{\@fpbot}{0bp \@plus1.0fil}
%    \end{macrocode}
%
% 下面这组命令使浮动对象的缺省值稍微宽松一点，从而防止幅度对象占据过多的文本页面，
% 也可以防止在很大空白的浮动页上放置很小的图形。
%    \begin{macrocode}
\renewcommand{\textfraction}{0.15}
\renewcommand{\topfraction}{0.85}
\renewcommand{\bottomfraction}{0.65}
\renewcommand{\floatpagefraction}{0.60}
%    \end{macrocode}
%
% 定制浮动图形和表格标题样式
% \begin{itemize}
%   \item 图表标题字体为 11pt， 这里写作大五号
%   \item 去掉图表号后面的冒号。图序与图名文字之间空一个汉字符宽度。
%   \item 图：caption 在下，段前空 6 磅，段后空 12 磅
%   \item 表：caption 在上，段前空 12 磅，段后空 6 磅
% \end{itemize}
% \changes{thuthesis v2.4}{2006/04/14}{表格内容为 11 磅。}
% \changes{thuthesis v2.4}{2006/04/14}{图表标题左对齐，取消原先漂亮的 hang 模式。}
% \changes{thuthesis v2.5}{2006/05/13}{标题上下间距重调，以前没有考虑 \cs{intextsep} 的影响。}
% \changes{thuthesis v2.5.1}{2006/05/23}{增加 \pkg{subfigure} 和 \pkg{subtable} 的 caption 配置。}
% \changes{thuthesis v2.5.1}{2006/05/24}{重新定义表格默认字体。}
% \changes{thuthesis v2.5.3}{2006/06/07}{不管 caption 出现在什么位置，\cs{aboveskip} 总是出现在标题和浮动体之间的距离。}
% \changes{thuthesis v4.3}{2008/03/11}{子图引用时加括号。}
% \changes{thuthesis v5.0.0}{2015/06/27}{本科附录图表编号用-不用.（如图A-1，表A-2）。}
%    \begin{macrocode}
\ifruc@bachelor
  \g@addto@macro\appendix{\renewcommand*{\thefigure}{\thechapter-\arabic{figure}}}
  \g@addto@macro\appendix{\renewcommand*{\thetable}{\thechapter-\arabic{table}}}
\fi
\let\old@tabular\@tabular
\def\ruc@tabular{\dawu[1.5]\old@tabular}
\DeclareCaptionLabelFormat{ruc}{{\dawu[1.5]\songti #1~\rmfamily #2}}
\DeclareCaptionLabelSeparator{ruc}{\hspace{1em}}
\DeclareCaptionFont{ruc}{\dawu[1.5]}
\captionsetup{labelformat=ruc,labelsep=ruc,font=ruc}
\captionsetup[table]{position=top,belowskip={12bp-\intextsep},aboveskip=6bp}
\captionsetup[figure]{position=bottom,belowskip={12bp-\intextsep},aboveskip=6bp}
\captionsetup[sub]{font=ruc,skip=6bp}
\renewcommand{\thesubfigure}{(\alph{subfigure})}
\renewcommand{\thesubtable}{(\alph{subtable})}
% \renewcommand{\p@subfigure}{:}
%    \end{macrocode}
% 我们采用 \pkg{longtable} 来处理跨页的表格。同样我们需要设置其默认字体为五号。
% \changes{thuthesis v2.5.3}{2006/06/08}{增加对 \pkg{longtable} 的处理。}
% \changes{thuthesis v4.5.1}{2009/01/06}{太好了，不用处理 \pkg{longtable} 的 \cs{caption}
% 了。}
%    \begin{macrocode}
\let\ruc@LT@array\LT@array
\def\LT@array{\dawu[1.5]\ruc@LT@array} % set default font size
%    \end{macrocode}
%
% \begin{macro}{\hlinewd}
% 简单的表格使用三线表推荐用 \cs{hlinewd}。如果表格比较复杂还是用 \pkg{booktabs} 的命
% 令好一些。
%    \begin{macrocode}
\def\hlinewd#1{%
  \noalign{\ifnum0=`}\fi\hrule \@height #1 \futurelet
    \reserved@a\@xhline}
%</cls>
%    \end{macrocode}
% \end{macro}
%
%
% \subsubsection{章节标题}
% \label{sec:theor}
% \changes{thuthesis v2.5}{2006/05/19}{增加索引名称定义。}
%    \begin{macrocode}
%<*cfg>
\ctexset{%
  chapter/name={第,章},
  appendixname=附录,
  contentsname={目\hspace{\ccwd}录},
  listfigurename=插图目录,
  listtablename=表格目录,
  figurename=图,
  tablename=表,
  bibname=参考文献,
  indexname=索引,
}
\newcommand\listequationname{公式目录}
\newcommand\equationname{公式}
\newcommand{\cabstractname}{摘\hspace{\ccwd}要}
\newcommand{\eabstractname}{Abstract}
\let\CJK@todaysave=\today
\def\CJK@todaysmall@short{\the\year 年 \the\month 月}
\def\CJK@todaysmall{\the\year 年 \the\month 月 \the\day 日}
\def\CJK@todaybig@short{\zhdigits{\the\year}年\zhnumber{\the\month}月}
\def\CJK@todaybig{\zhdigits{\the\year}年\zhnumber{\the\month}月\zhnumber{\the\day}日}
\def\CJK@today{\CJK@todaysmall}
\renewcommand\today{\CJK@today}
\newcommand\CJKtoday[1][1]{%
  \ifcase#1\def\CJK@today{\CJK@todaysave}
    \or\def\CJK@today{\CJK@todaysmall}
    \or\def\CJK@today{\CJK@todaybig}
  \fi}
%</cfg>
%    \end{macrocode}
%
% 如果章节题目中的英文要使用 arial，那么就加上 \cs{sffamily}
%    \begin{macrocode}
%<*cls>
\def\ruc@title@font{%
  \ifruc@arialtitle\sffamily\else\heiti\fi}
%    \end{macrocode}
%
% \pkg{fancyhdr} 定义页眉页脚很方便，但是有一个非常隐蔽的坑。通过 \pkg{fancyhdr}
% 定义的样式在第一次被调用时会修改 \cs{chaptermark}，这会导致页眉信息错误（多余
% 章号并且英文大写）。这是因为在原始的 \file{book.cls} 中定义如下（大意）：
% \begin{latex}
% \newcommand\chaptername{Chapter}
% \newcommand\@chapapp{\chaptername}
% \def\chaptermark#1{
%   \markboth{\MakeUppercase{\@chapapp\ \thechapter}}{}}
% \end{latex}
% 很显然这个 \cs{\@chapapp} 不适合中文，因此我们使用\cs{CTEXthechapter}（
% 如，“第 x 章”），同时会将 \cs{MakeUppercase} 去掉。也就是说我们会做如下动作：
% \begin{latex}
% \renewcommand{\chaptermark}[1]{\@mkboth{\CTEXthechapter\hskip\ccwd#1}{}}
% \end{latex}
% 但，\pkg{fancyhdr} 不知何故在 \cs{ps@fancy} 中对 \cs{chaptermark} 进行重定义
% （其实一模一样），而这个 \cs{ps@fancy} 会在 \cs{fancypagestyle} 中使用，如下：
% \begin{latex}
% \newcommand{\fancypagestyle}[2]{%
%   \@namedef{ps@#1}{\let\fancy@gbl\relax#2\relax\ps@fancy}}
% \end{latex}
% 这样的话，\cs{ps@fancy} 会在 \pkg{fancyhdr} 定义的任何样式首次样被激活时调用，从
% 而覆盖我们的 \cs{chaptermark} 定义（后续样式再激活不会重复覆盖）。所以我们采用如下
% 方法解决：
%    \begin{macrocode}
\AtBeginDocument{%
  \pagestyle{ruc@logo}
  \renewcommand{\chaptermark}[1]{\@mkboth{\CTEXthechapter\hskip\ccwd#1}{}}}
%    \end{macrocode}
%
% 各级标题格式设置。
% \changes{thuthesis v5.0.0}{2012/12/23}{用 \cs{ctexset} 来设置，替换复杂的 \cs{@startsection}。}
% \begin{description}
% \item[chapter] 章序号与章名之间空一个汉字符 黑体三号字，居中书写，单倍行距，段
%   前空 24 磅，段后空 18 磅。本科：段前段后间距 30/20 pt，行距 20pt。
%
% \changes{thuthesis v2.5}{2006/05/13}{取消 \pkg{titlesec} 宏包，用基本 \LaTeX\ 命令格式化标题。}
% \changes{thuthesis v2.5.1}{2006/05/23}{让 \cs{chapter*} 自动 \cs{markboth}。}
% \changes{thuthesis v3.1}{2006/06/16}{英文摘要标题要搞特殊化。}
% \changes{thuthesis v5.0.0}{2015/04/17}{修正章节间距问题(\#57)}
%
% \item[section] 一级节标题，例如：\fbox{2.1 实验装置与实验方法}。节标题序号与标
%   题名之间空一个汉字符（下同）。采用黑体四号（14pt）字居左书写，行距为固定
%   值 20 磅，段前空 24 磅，段后空 6 磅。本科：25/12 pt，行距 18pt。
%
% \changes{thuthesis v4.4}{2008/06/04}{调整段前距为 -20bp 而不是原来的 -24bp。}
%
% \item[subsection] 二级节标题，例如：\fbox{2.1.1 实验装置}。采用黑体 13pt (本科
%   生是 14pt) 字居左书写，行距为固定值 20 磅，段前空 12 磅，段后空 6 磅。
%
% \changes{thuthesis v4.4}{2008/06/04}{修改本科生模板的二级节标题为小四而不是半小四。}
% \changes{thuthesis v4.4}{2008/06/04}{调整段前距为 -12bp 而不是原来的 -16bp。}
%
% \item[subsubsection] 三级节标题，例如：\fbox{2.1.2.1 归纳法}。采用黑体小四号
%   （12pt）字居左书写，行距为固定值 20 磅，段前空 12 磅，段后空 6 磅。
%
% \changes{thuthesis v4.4}{2008/06/04}{调整段前距为 -12bp 而不是原来的 -16bp。}
% \end{description}
%    \begin{macrocode}
\newcommand\ruc@chapter@titleformat[1]{%
  \ifruc@bachelor #1\else%
    \ifthenelse%
      {\equal{#1}{\eabstractname}}%
      {\bfseries #1}%
      {#1}%
  \fi}
\ctexset{%
  chapter={
    afterindent=true,
    pagestyle={\ifruc@bachelor ruc@logo\else ruc@headings\fi},
    beforeskip={\ifruc@bachelor 13bp\else 9bp\fi},
    aftername=\hskip\ccwd,
    afterskip={\ifruc@bachelor 20bp\else 24bp\fi},
    format={\centering\ruc@title@font\heiti\ifruc@bachelor\sanhao\else\sanhao[1]\fi},
    nameformat=\relax,
    numberformat=\relax,
    titleformat=\ruc@chapter@titleformat,
  },
  section={
    afterindent=true,
    beforeskip={\ifruc@bachelor 25bp\else 24bp\fi\@plus 1ex \@minus .2ex},
    afterskip={\ifruc@bachelor 12bp\else 6bp\fi \@plus .2ex},
    format={\ruc@title@font\heiti\sihao[1.429]},
  },
  subsection={
    afterindent=true,
    beforeskip={\ifruc@bachelor 12bp\else 16bp\fi\@plus 1ex \@minus .2ex},
    afterskip={6bp \@plus .2ex},
    format={\ruc@title@font\heiti\ifruc@bachelor\xiaosi[1.667]\else\banxiaosi[1.538]\fi},
  },
  subsubsection={
    afterindent=true,
    beforeskip={\ifruc@bachelor 12bp\else 16bp\fi\@plus 1ex \@minus .2ex},
    afterskip={6bp \@plus .2ex},
    format={\csname ruc@title@font\endcsname\heiti\xiaosi[1.667]},
  },
  paragraph/afterindent=true,
  subparagraph/afterindent=true}
%    \end{macrocode}
%
% \begin{macro}{\ruc@chapter*}
% \changes{thuthesis v2.5.2}{2006/05/29}{定义自己的 \cs{thu@chapter*}。}
% 默认的 \cs{chapter*} 很难同时满足研究生院和本科生的论文要求。本科论文要求所有的
% 章都出现在目录里，比如摘要、Abstract、主要符号表等，所以可以简单的扩展默
% 认\cs{chapter*} 实现这个目的。但是研究生又不要这些出现在目录中，而且致谢和声明
% 部分的章名、页眉和目录都不同，所以定义一个灵活的 \cs{thu@chapter*} 专门处理这些
% 要求。
%
% \cs{ruc@chapter*}\oarg{tocline}\marg{title}\oarg{header}: tocline 是出现在目录
% 中的条目，如果为空则此 chapter 不出现在目录中，如果省略表示目录出现 title；
% title 是章标题；header 是页眉出现的标题，如果忽略则取 title。通过这个宏我才真
% 正体会到 \TeX\ macro 的力量！
%    \begin{macrocode}
\newcounter{ruc@bookmark}
\NewDocumentCommand\ruc@chapter{s o m o}{
  \IfBooleanF{#1}{%
    \ClassError{ructhesis}{You have to use the star form: \string\ruc@chapter*}{}
  }%
  \if@openright\cleardoublepage\else\clearpage\fi\phantomsection%
  \IfValueTF{#2}{%
    \ifthenelse{\equal{#2}{}}{%
      \addtocounter{ruc@bookmark}\@ne
      \pdfbookmark[0]{#3}{rucchapter.\theruc@bookmark}
    }{%
      \addcontentsline{toc}{chapter}{#3}
    }
  }{%
    \addcontentsline{toc}{chapter}{#3}
  }%
  \chapter*{#3}%
  \IfValueTF{#4}{%
    \ifthenelse{\equal{#4}{}}
    {\@mkboth{}{}}
    {\@mkboth{#4}{#4}}
  }{%
    \@mkboth{#3}{#3}
  }
}
%</cls>
%    \end{macrocode}
% \end{macro}
%
%
% \subsubsection{目录}
% \label{sec:toc}
% 最多 4 层，即: x.x.x.x，对应的命令和层序号分别是：
% \cs{chapter}(0), \cs{section}(1), \cs{subsection}(2), \cs{subsubsection}(3)。
% \changes{thuthesis v3.1}{2007/10/09}{博士论文目录只出现到第 3 级标题即可。}
% \changes{thuthesis v5.0.0}{2015/05/21}{硕士博士论文目录只出现到第 3 级标题即可。其他未明确要求。}
%    \begin{macrocode}
%<*cls>
\setcounter{secnumdepth}{3}
\setcounter{tocdepth}{2}
%    \end{macrocode}
%
% 每章标题行前空 6 磅，后空 0 磅。如果使用目录项中英文要使用 Arial，那么就加上 \cs{sffamily}。
% 章节名中英文用 Arial 字体，页码仍用 Times。
% \begin{macro}{\tableofcontents}
% \changes{thuthesis v2.0}{2005/12/18}{附录的目录项需要调整一下。以及公式编号方式等等。}
% \changes{thuthesis v2.5}{2006/05/13}{取消 \pkg{titletoc} 宏包，用 \cs{dottedtocline} 调整
%   目录。}
% \changes{thuthesis v2.5.1}{2006/05/23}{减小目录项中的导引小点跟页码之间的留白。}
% \changes{thuthesis v2.5.2}{2006/05/29}{用 \cs{thu@chapter*} 改写目录命令。}
% \changes{thuthesis v3.0}{2007/05/12}{缩小目录中标题与页码之间\textbf{点}之间的距离。}
% \changes{thuthesis v4.0}{2007/11/08}{本科研究生目录字号行距都不同。}
% \changes{thuthesis v4.4}{2008/06/04}{本科生目录字号改回\cs{xiaosi}\oarg{1.8}。}
% \changes{thuthesis v4.4}{2008/06/04}{本科生目录缩进要求不同。}
% \changes{thuthesis v4.4}{2008/06/18}{本科章目录项一直用黑体 (Arial)。}
% 目录生成命令。
%    \begin{macrocode}
\renewcommand\tableofcontents{%
  \ruc@chapter*[]{\contentsname}
  \ifruc@bachelor\xiaosi[1.8]\else\xiaosi[1.65]\fi\@starttoc{toc}\normalsize}
%    \end{macrocode}
% 调整目录样式，允许指定目录字体。
% \changes{thuthesis v5.2.2}{2016/01/23}{用 \cs{patchcmd} 修改 \cs{@dottedtocline}。}
%    \begin{macrocode}
\ifruc@arialtoc
  \def\ruc@toc@font{\sffamily}
\fi
\def\@pnumwidth{2em}
\def\@tocrmarg{\@pnumwidth}
\def\@dotsep{1}
\patchcmd{\@dottedtocline}{#4}{\csname ruc@toc@font\endcsname #4}{}{}
\patchcmd{\@dottedtocline}{\hb@xt@\@pnumwidth}{\hbox}{}{}
\renewcommand*\l@chapter[2]{%
  \ifnum \c@tocdepth >\m@ne
    \addpenalty{-\@highpenalty}%
    \vskip 4bp \@plus\p@
    \setlength\@tempdima{4em}%
    \begingroup
      \parindent \z@ \rightskip \@pnumwidth
      \parfillskip -\@pnumwidth
      \leavevmode
      \advance\leftskip\@tempdima
      \hskip -\leftskip
      % numberline is called here, and it uses \@tempdima
      {\csname ruc@toc@font\endcsname\heiti #1}
      \leaders\hbox{$\m@th\mkern \@dotsep mu\hbox{.}\mkern \@dotsep mu$}\hfill
      \nobreak{\normalfont\normalcolor #2}\par
      \penalty\@highpenalty
    \endgroup
  \fi}
%    \end{macrocode}
%
% 研究生学位论文写作指南中规定：目录中的章标题行居左书写，一级节标题行缩进 1 个
% 汉字符，二级节标题行缩进 2 个汉字符（但示例文件中为 1.5 个汉字符）。本科生指
% 南中未作明确规定，示例文件中对于一级和二级节标题分别缩进 1 和 1.5 个汉字符。
% \changes{v5.0.0}{2015/04/28}{修正学位论文中目录里节前缩进(\#103)}
%    \begin{macrocode}
\renewcommand*\l@section{%
  \@dottedtocline{1}{\ccwd}{2.1em}}
\renewcommand*\l@subsection{%
  \@dottedtocline{2}{\ifruc@bachelor 1.5\ccwd\else 2\ccwd\fi}{3em}}
\renewcommand*\l@subsubsection{%
  \@dottedtocline{3}{\ifruc@bachelor 2.4em\else 3.5em\fi}{3.8em}}
%</cls>
%    \end{macrocode}
% \end{macro}
%
%
% \subsubsection{封面和封底}
% \label{sec:cover}
% \begin{macro}{\ruc@def@term}
% 方便的定义封面的一些替换命令。
% \changes{thuthesis v2.6.2}{2006/06/18}{引入 \cs{thu@def@term} 定义封面命令。}
% \changes{thuthesis v3.1}{2006/06/16}{重新定义摘要为环境，long 选项不需要了。}
%    \begin{macrocode}
%<*cls>
\def\ruc@def@term#1{%
  \define@key{ruc}{#1}{\csname #1\endcsname{##1}}
  \expandafter\gdef\csname #1\endcsname##1{%
    \expandafter\gdef\csname ruc@#1\endcsname{##1}}
  \csname #1\endcsname{}}
%    \end{macrocode}
% \end{macro}
%
% \changes{thuthesis v2.0}{2005/12/18}{增加了封面密级，增加博士封面支持}
% \changes{thuthesis v4.6}{2011/04/27}{增加博士后相关指令。}
% \changes{ructhesis v0.0.1}{2017/05/09}{增加封面论文编码、年级、学号、论文成绩。}
%
% \begin{macro}{\secretlevel}
% \begin{macro}{\secretyear}
% 定义密级参数。
%    \begin{macrocode}
\ruc@def@term{secretlevel}
\ruc@def@term{secretyear}
%    \end{macrocode}
% \end{macro}
% \end{macro}
%
% \begin{macro}{\ctitle}
% \begin{macro}{\etitle}
% 论文中英文题目。
%    \begin{macrocode}
\ruc@def@term{ctitle}
\ruc@def@term{etitle}
%    \end{macrocode}
% \end{macro}
% \end{macro}
%
% \begin{macro}{\ccodeno}
% 论文编码。
%    \begin{macrocode}
\ruc@def@term{ccodeno}
%    \end{macrocode}
% \end{macro}
%
% \begin{macro}{\cauthor}
% \begin{macro}{\eauthor}
% 论文作者。
%    \begin{macrocode}
\ruc@def@term{cauthor}
\ruc@def@term{eauthor}
%    \end{macrocode}
% \end{macro}
% \end{macro}
%
% \begin{macro}{\cdegree}
% \begin{macro}{\edegree}
% 学位中英文。
%    \begin{macrocode}
\ruc@def@term{cdegree}
\ruc@def@term{edegree}
%    \end{macrocode}
% \end{macro}
% \end{macro}
%
% \begin{macro}{\cdepartment}
% \begin{macro}{\edepartment}
% 学院中英文名称。
%    \begin{macrocode}
\ruc@def@term{cdepartment}
\def\caffil{% for compatibility
  \ClassWarning{ructhesis}
    {'\string\caffil' is deprecated, please use '\string\cdepartment' instead.}{}%
  \cdepartment}
\ruc@def@term{edepartment}
\def\eaffil{% for compability
  \ClassWarning{ructhesis}
    {'\string\eaffil' is deprecated, please use '\string\edepartment' instead.}{}%
  \edepartment}
%    \end{macrocode}
% \end{macro}
% \end{macro}
%
% \begin{macro}{\cmajor}
% \begin{macro}{\emajor}
% 专业中英文名称。
% \changes{thuthesis v2.5}{2006/05/20}{院系和专业分别改名用 department 和 major，代替原来
% 的 affil 和 subject。}
%    \begin{macrocode}
\ruc@def@term{cmajor}
\def\csubject{% for compatibility
  \ClassWarning{ructhesis}
    {'\string\csubject' is deprecated, please use '\string\cmajor' instead.}{}%
  \cmajor}
\ruc@def@term{emajor}
\def\esubject{%for compability
  \ClassWarning{ructhesis}
    {'\string\esubject' is deprecated, please use '\string\emajor' instead.}{}%
  \emajor}
%    \end{macrocode}
% \end{macro}
% \end{macro}
%
% \begin{macro}{\cgrade}
% \begin{macro}{\cstudentid}
% 作者年级、学号。
%    \begin{macrocode}
\ruc@def@term{cgrade}
\ruc@def@term{cstudentid}
%    \end{macrocode}
% \end{macro}
% \end{macro}
%
% \begin{macro}{\csupervisor}
% \begin{macro}{\cassosupervisor}
% \begin{macro}{\ccosupervisor}
% \begin{macro}{\esupervisor}
% \begin{macro}{\eassosupervisor}
% \begin{macro}{\ecosupervisor}
% 导师、副导师、联合指导老师。
%    \begin{macrocode}
\ruc@def@term{csupervisor}
\ruc@def@term{cassosupervisor}
\ruc@def@term{ccosupervisor}
\ruc@def@term{esupervisor}
\ruc@def@term{eassosupervisor}
\ruc@def@term{ecosupervisor}
%    \end{macrocode}
% \end{macro}
% \end{macro}
% \end{macro}
% \end{macro}
% \end{macro}
% \end{macro}
%
% \begin{macro}{\cscore}
% 论文成绩。
%    \begin{macrocode}
\ruc@def@term{cscore}
%    \end{macrocode}
% \end{macro}
%
% \begin{macro}{\cdate}
% \begin{macro}{\edate}
% 论文成文日期。
%    \begin{macrocode}
\ruc@def@term{cdate}
\ruc@def@term{edate}
%    \end{macrocode}
% \end{macro}
% \end{macro}
%
% \begin{environment}{cabstract}
% \begin{environment}{eabstract}
% 摘要最好以环境的形式出现（否则命令的形式会导致开始结束的括号距离太远，我不喜
% 欢），这就必须让环境能够自己保存内容留待以后使用。使用 \pkg{environ} 的
% \cs{Collect@Body} 来实现。
% \changes{thuthesis v3.1}{2006/06/17}{重新定义摘要成为环境。}
% \changes{thuthesis v5.2.2}{2016/01/31}{用 \pkg{environ} 封装的 \cs{Collect@Body}。}
%    \begin{macrocode}
\newcommand{\ruc@@cabstract}[1]{\long\gdef\ruc@cabstract{#1}}
\newenvironment{cabstract}{\Collect@Body\ruc@@cabstract}{}
\newcommand{\ruc@@eabstract}[1]{\long\gdef\ruc@eabstract{#1}}
\newenvironment{eabstract}{\Collect@Body\ruc@@eabstract}{}
%    \end{macrocode}
% \end{environment}
% \end{environment}
%
% \begin{macro}{\ruc@parse@keywords}
%   不同论文格式关键词之间的分割不太相同，我们用 \cs{ckeywords} 和
%    \cs{ekeywords} 来收集关键词列表，然后用本命令来生成符合要求的格式。
%    \begin{macrocode}
\def\ruc@parse@keywords#1{
  \define@key{ruc}{#1}{\csname #1\endcsname{##1}}
  \expandafter\gdef\csname ruc@#1\endcsname{}
  \expandafter\gdef\csname #1\endcsname##1{
    \@for\reserved@a:=##1\do{
      \expandafter\ifx\csname ruc@#1\endcsname\@empty\else
        \expandafter\g@addto@macro\csname ruc@#1\endcsname{%
          \ignorespaces\csname ruc@#1@separator\endcsname}
      \fi
      \expandafter\expandafter\expandafter\g@addto@macro%
        \expandafter\csname ruc@#1\expandafter\endcsname\expandafter{\reserved@a}}}}
%    \end{macrocode}
% \end{macro}
% \begin{macro}{\ckeywords}
% \begin{macro}{\ekeywords}
% 利用 \cs{ruc@parse@keywords} 来定义，内部通过 \cs{ruc@ckeywords} 和
% \cs{ruc@ekeywords} 来引用。
% \changes{thuthesis v3.1}{2007/06/16}{增强的关键词命令。}
%    \begin{macrocode}
\ruc@parse@keywords{ckeywords}
\ruc@parse@keywords{ekeywords}
%    \end{macrocode}
% \end{macro}
% \end{macro}
%
% \begin{environment}{addpages}
% 增加封面附加页，用来放本科论文简表。
% \changes{ructhesis v0.0.1}{2017/05/09}{增加封面附加页。}
%    \begin{macrocode}
\newcommand{\ruc@@addpages}[1]{\long\gdef\ruc@addpages{#1}}
\newenvironment{addpages}{\Collect@Body\ruc@@addpages}{}
%    \end{macrocode}
% \end{environment}
%
% \begin{macro}{\rucsetup}
% \changes{thuthesis v5.1.0}{2015/12/26}{通过 \cs{thusetup} 统一设置封面信息。}
% 由上可见，封面和封底有一大堆信息需要设置，为了简化操作界面，提供一
% 个 \cs{thusetup} 命令支持 key/value 的方式来设置。key 就是前面各个设置项的
% 名字。\note[说明：]{只能设置普通项，不支持环境项，
% 如 \texttt{cabstract} 和 \texttt{eabstract}。} 由于这些设置项被 \cs{makecover}
% 调用，所以此命令需要在 \cs{makecover} 之前被调用。
%    \begin{macrocode}
\def\rucsetup{\kvsetkeys{ruc}}
%</cls>
%    \end{macrocode}
% \end{macro}
%
% \changes{thuthesis v1.4rc1}{2005/12/14}{I have to put all chinese chars into cfg,
% otherwise they would not appear.}
% \changes{thuthesis v2.5.1}{2006/05/25}{硕士封面的冒号前居然有点小距离！}
% \changes{thuthesis v3.1}{2007/10/09}{去掉配置文件中的 \cs{hfill}。}
% \changes{thuthesis v3.1}{2007/10/09}{\textbf{内部}密级前面要五角星了。}
% \changes{thuthesis v4.0}{2007/11/08}{\textbf{内部}密级前面终究还是不要五角星了。}
% \changes{thuthesis v4.4.2}{2008/06/05}{本科生格式终于也开始用空格作为关键字分隔符了。}
% \changes{thuthesis v4.4.2}{2008/06/07}{本科生签名之间距离改为 \cs{hskip1em}。}
% \changes{thuthesis v4.5.2}{2010/05/29}{本科论文日期具体到日。}
% \changes{thuthesis v4.6}{2011/04/26}{增加博士后相关配置。}
% \changes{thuthesis v4.7}{2012/05/27}{修正本科生作者信息名称。}
% \changes{thuthesis v4.7}{2012/05/27}{本科生关键字也用分号分割了。}
% \changes{thuthesis v5.3.0}{2016/03/11}{更新到研究生院 2016.3 指南。}
% \changes{ructhesis v0.0.1}{2017/05/09}{更新封面文字信息。}
% \changes{ructhesis v0.0.1}{2017/05/09}{增加原创性声明和版权声明。}
% 定义封面用到的各种文字。
%    \begin{macrocode}
%<*cfg>
\def\ruc@ckeywords@separator{；}
\def\ruc@ekeywords@separator{;}
\def\ruc@catalog@number@title{分类号}
\def\ruc@id@title{编号}
\def\ruc@title@sep{：}
\def\ruc@secretlevel{密级}
\def\ruc@secretyear{\the\year}
\def\ruc@titleno{论文编码：\ruc@ccodeno}
\def\ruc@schoolname{中国人民大学}
\def\ruc@bachelor@subtitle{中国人民大学本科学生毕业论文}
\def\ruc@bachelor@title@pre{}
\ifruc@bachelor
  \def\ruc@author@title{作者}
\else
  \def\ruc@author@title{研究生}
\fi
\def\ruc@secret@content{%
  \unskip\ifruc@master$\bigstar$ \fi%
  \ifruc@doctor$\bigstar$ \fi%
  \ruc@secretyear 年}
\def\ruc@apply{（申请中国人民大学\ruc@cdegree 学位论文）}
\ifruc@bachelor
  \def\ruc@department@title{学院}
  \def\ruc@major@title{专业}
\else
  \def\ruc@department@title{培养单位}
  \def\ruc@major@title{学科}
\fi
\def\ruc@grade@title{年级}
\def\ruc@studentid@title{学号}
\def\ruc@supervisor@title{指导教师}
\ifruc@bachelor
  \def\ruc@assosuper@title{辅导教师}
\else
  \def\ruc@assosuper@title{副指导教师}
\fi
\def\ruc@cosuper@title{%
  \iftruc@doctor 联合导师\else \ifruc@master 联合指导教师\fi\fi}
\cdate{\ifruc@bachelor\CJK@todaysmall\else\CJK@todaybig@short\fi}
\edate{\ifcase \month \or January\or February\or March\or April\or May%
       \or June\or July \or August\or September\or October\or November
       \or December\fi\unskip,\ \ \the\year}
\def\ruc@score@title{论文成绩}
\def\ruc@date@title{日期}
\newcommand{\ruc@declarename}{学位论文原创性声明}
\newcommand{\ruc@declaretext}{%
本人郑重声明：所呈交的论文是本人在导师的指导下独立进行研究所取得的研究成果。除了文中特别加以标注引用的内容外，本论文不包括任何其他个人或集体已经发表或撰写的成果作品。本人完全意识到本声明的法律后果由本人承担。
}
\newcommand{\ruc@authtitle}{学位论文版权使用授权书}
\newcommand{\ruc@authorization}{%
%\ifruc@bachelor
本学位论文作者完全了解学校有关保障、使用学位论文的规定，同意学校保留并向有关学位论文管理部门或机构送交论文的复印件和电子版，允许论文被查阅和借阅。本人授权优秀学士论文评选机构将本学位论文的全部或部分内容编入有关数据进行检索，可以采用影印、缩印或扫描等复制手段保存和汇编本学位论文。
}
\def\ruc@secret@squareone{
  \ifruc@secret{\xiaosan\CheckedBox}\else{\sanhao\Square}\fi}
\def\ruc@secret@squaretwo{
  \ifruc@secret{\sanhao\Square}\else{\xiaosan\CheckedBox}\fi}
\def\ruc@secret@check{
  {\xiaosan\checked}}
\newcommand{\ruc@authorizationaddon}{%
\settowidth{\hangindent}{空格本学位论文属于~}
\mbox{本学位论文属于~}~1、保密\ruc@secret@squareone，在10年解密后适用本授权书\\
\mbox{}~2、不保密\ruc@secret@squaretwo。\\
\mbox{}（请在以上相应方框内打“\ruc@secret@check”）
}
\newcommand{\ruc@authorsig}{作者签名：}
\newcommand{\ruc@teachersig}{导师签名：}
\newcommand{\ruc@sigdate}{%
  \hspace{2em}年\hspace{1.25em}月\hspace{1.25em}日}
\newcommand{\ruc@ckeywords@title}{关键词：}
%</cfg>
%    \end{macrocode}
%
%
% \myentry{封面第一页}
% \begin{macro}{\ruc@first@titlepage}
% 题名使用一号黑体字，一行写不下时可分两行写，并采用 1.25 倍行距。
% 申请学位的学科门类: 小二号宋体字。
% 中文封面页边距：
%  上- 6.0 厘米，下- 5.5 厘米，左- 4.0 厘米，右- 4.0 厘米，装订线 0 厘米；
% \changes{thuthesis v2.5.1}{2006/05/21}{本科封面标题调整微小的空隙。}
% \changes{thuthesis v2.5.1}{2006/05/21}{本科封面标题第二行的横线上移一点。}
% \changes{thuthesis v2.5.2}{2006/05/29}{研究生论文标题中英文用 arial 字体。}
% \changes{thuthesis v2.6}{2006/06/09}{本科生题目加长，最多 24 个字。}
% \changes{thuthesis v4.6}{2011/04/26}{增加博士后封面。}
% \changes{thuthesis v4.7}{2011/11/28}{硕士中文封面不再需要英文标题。}
% \changes{thuthesis v4.7}{2012/05/30}{本科生题目下划线长度自动适应字数。}
% \changes{thuthesis v5.1.0}{2015/12/27}{利用 \env{CJKfilltwosides} 优化封面排版。}
% \changes{ructhesis v0.0.1}{2017/05/09}{更新封面。}
%
%    \begin{macrocode}
%<*cls>
\newcommand\ruc@underline[2][6em]{\hskip1pt\underline{\hb@xt@ #1{\hss#2\hss}}\hskip3pt}
\newlength{\ruc@title@width}
\newcommand{\ruc@put@title}[2][\ruc@title@width]{%
  \begin{CJKfilltwosides}[b]{#1}#2\end{CJKfilltwosides}}
\def\ruc@first@titlepage{\ruc@first@titlepage@all}
\newcommand{\ruc@first@titlepage@all}{
  \begin{flushright}
    {\xiaosi\heiti\ruc@titleno}
  \end{flushright}
  \begin{center}
    \vspace*{-2.4cm}
    \parbox[b][2.4cm][t]{\textwidth}{%
      \ifruc@secret{\heiti\sanhao\ruc@secretlevel\ruc@secret@content}\else\rule{1cm}{0cm}\fi}
    \ifruc@bachelor
      \vskip0.5cm
      {\fontsize{28bp}{28bp}\bfseries\ruc@bachelor@subtitle}
      \vskip1.3cm
      {\fontsize{28bp}{28bp}\bfseries\ruc@ctitle}
      \vskip1.3cm
    \else
      \vskip0.8cm
      \parbox[t][9cm][t]{\paperwidth-8cm}{
      \renewcommand{\baselinestretch}{1.3}
      \begin{center}
        \yihao[1.2]{\sffamily\heiti\ruc@ctitle}\par%
        \par\vskip 18bp%
        \xiaoer[1]\textrm{\ruc@apply}%
      \end{center}}
    \fi
%    \end{macrocode}
%
% 作者及导师信息部分使用三号仿宋字
% \changes{thuthesis v2.0}{2005/12/20}{封面的培养单位，学科等内容字距自动调整。}
% \changes{thuthesis v2.1}{2006/02/29}{增加本科部分。}
% \changes{thuthesis v2.6.2}{2006/06/17}{如果本科生没有辅导教师则不显示。}
% \changes{thuthesis v3.1}{2007/10/09}{重新放置封面表格的提示元素。}
% \changes{thuthesis v4.4.3}{2008/06/09}{修改本科生论文封面格式以符合新样例。}
% \changes{thuthesis v5.1.0}{2015/12/27}{修改联合指导教师显示问题。}
% \changes{ructhesis v0.0.1}{2017/05/09}{更新封面表格。}
%    \begin{macrocode}
    \ifruc@bachelor
      \vskip3.2cm
      {\xiaoer[1.8]\heiti
        \setlength{\ruc@title@width}{4em}
        \setlength{\extrarowheight}{6pt}
        \setlength{\tabcolsep}{0pt}
        \begin{tabular}{llc}
	       \ruc@put@title{\ruc@author@title}     & \ruc@title@sep\hskip1pt
             & \ruc@underline[11em]{\ruc@cauthor}\\
           \ruc@put@title{\ruc@department@title} & \ruc@title@sep\hskip1pt
             & \ruc@underline[11em]{\ruc@cdepartment}\\
           \ruc@put@title{\ruc@major@title}      & \ruc@title@sep\hskip1pt
             & \ruc@underline[11em]{\ruc@cmajor}\\
           \ruc@put@title{\ruc@grade@title}      & \ruc@title@sep\hskip1pt
             & \ruc@underline[11em]{\ruc@cgrade}\\
           \ruc@put@title{\ruc@studentid@title}  & \ruc@title@sep\hskip1pt
             & \ruc@underline[11em]{\ruc@cstudentid}\\
           \ruc@put@title{\ruc@supervisor@title} & \ruc@title@sep\hskip1pt
             & \ruc@underline[11em]{\ruc@csupervisor}\\
           \ifx\ruc@cassosupervisor\@empty\else%
             \ruc@put@title{\ruc@assosuper@title} & \ruc@title@sep\hskip1pt
             & \ruc@underline[11em]{\ruc@cassosupervisor}\\
           \fi
           \ruc@put@title{\ruc@score@title}      & \ruc@title@sep\hskip1pt
             & \ruc@underline[11em]{\ruc@cscore}\\
           \ruc@put@title{\ruc@date@title}       & \ruc@title@sep\hskip1pt
             & \ruc@underline[11em]{\ruc@cdate}\\
         \end{tabular}
       }
    \else
      \vskip 5bp
      \parbox[t][7.8cm][t]{\textwidth}{{\sanhao[1.5]
        \begin{center}\fangsong
          \setlength{\ruc@title@width}{5em}
          \setlength{\extrarowheight}{4pt}
          \ifxetex
            \begin{tabular}{p{\ruc@title@width}@{}c@{\extracolsep{8pt}}l}
          \else
            \begin{tabular}{p{\ruc@title@width}c@{\extracolsep{4pt}}l}
          \fi
              \ruc@put@title{\ruc@department@title}  & \ruc@title@sep
                & {\ziju{0.1875}\ruc@cdepartment}\\
              \ruc@put@title{\ruc@major@title}       & \ruc@title@sep
                & {\ziju{0.1875}\ruc@cmajor}\\
              \ruc@put@title{\ruc@author@title}      & \ruc@title@sep
                & {\ziju{0.6875}\ruc@cauthor}\\
              \ruc@put@title{\ruc@supervisor@title}  & \ruc@title@sep
                & {\ziju{0.6875}\ruc@csupervisor}\\
              \ifx\ruc@cassosupervisor\@empty\else
                \ruc@put@title{\ruc@assosuper@title} & \ruc@title@sep
                & {\ziju{0.6875}\ruc@cassosupervisor}\\
              \fi
              \ifx\ruc@ccosupervisor\@empty\else
                \hfill\makebox[0pt][r]{\ruc@cosuper@title} & \ruc@title@sep
                & {\ziju{0.6875}\ruc@ccosupervisor}\\
              \fi
            \end{tabular}
        \end{center}}}
      \fi
%    \end{macrocode}
%
% \changes{thuthesis v4.4.3}{2008/06/09}{修改本科生论文封面日期格式以符合新样例。}
% \changes{ructhesis v0.0.1}{2017/05/09}{封面日期移至表格中。}
%    \begin{macrocode}
    \end{center}} % end of titlepage
%</cls>
%    \end{macrocode}
% \end{macro}
%
% \myentry{英文封面}
% \begin{macro}{\ruc@doctor@engcover}
% \changes{thuthesis v4.2}{2008/01/23}{博士英文封面补充联合导师。}
% \changes{thuthesis v4.7}{2011/11/28}{硕士生新增英文封面。}
% 研究生论文使用。
%    \begin{macrocode}
%<*cfg>
\def\ruc@master@art{Master of Arts}
\def\ruc@master@sci{Master of Science}
\def\ruc@doctor@phi{Doctor of Philosophy}
%</cfg>
%<*cls>
\newcommand{\ruc@engcover}{%
  \newif\ifruc@professional\ruc@professionalfalse
  \ifruc@master
    \ifthenelse{\equal{\ruc@edegree}{\ruc@master@art}}
      {\relax}
      {\ifthenelse{\equal{\ruc@edegree}{\ruc@master@sci}}
        {\relax}
        {\ruc@professionaltrue}}
  \fi
  \ifruc@doctor
    \ifthenelse{\equal{\ruc@edegree}{\ruc@doctor@phi}}
      {\relax}
      {\ruc@professionaltrue}
  \fi
  \begin{center}
    \vspace*{-5pt}
    \parbox[t][5.2cm][t]{\paperwidth-7.2cm}{
      \renewcommand{\baselinestretch}{1.5}
      \begin{center}
        \erhao[1.1]\bfseries\sffamily\ruc@etitle%
      \end{center}}
    \parbox[t][][t]{\paperwidth-7.2cm}{
      \renewcommand{\baselinestretch}{1.3}
      \begin{center}
        \sanhao%
        \ifruc@master Thesis \else Dissertation \fi
        Submitted to\\
        {\bfseries Renmin University of China}\\
        in partial fulfillment of the requirement\\
        for the \ifruc@professional professional \fi
        degree of\\
        {\bfseries\sffamily\ruc@edegree}%
        \ifruc@professional\relax\else
          \\in\\[3bp]
          {\bfseries\sffamily\ruc@emajor}%
        \fi
      \end{center}}
    \parbox[t][][b]{\paperwidth-7.2cm}{
      \renewcommand{\baselinestretch}{1.3}
      \begin{center}
        \sanhao\sffamily by\\[3bp]
        \bfseries\ruc@eauthor%
        \ifruc@professional
          \ifx\ruc@emajor\empty\relax\else
            \\(~\ruc@emajor~)%
        \fi\fi
      \end{center}}
    \par\vspace{0.9cm}
    \parbox[t][2.1cm][t]{\paperwidth-7.2cm}{
      \renewcommand{\baselinestretch}{1.2}
      \xiaosan\centering
      \begin{tabular}{rl}
        \ifruc@master Thesis \else Dissertation \fi
        Supervisor : & \ruc@esupervisor\\
        \ifx\ruc@eassosupervisor\@empty
          \else Associate Supervisor : & \ruc@eassosupervisor\\\fi
        \ifx\ruc@ecosupervisor\@empty
          \else Cooperate Supervisor : & \ruc@ecosupervisor\\\fi
      \end{tabular}}
    \parbox[t][2cm][b]{\paperwidth-7.2cm}{
    \begin{center}
      \sanhao\bfseries\sffamily\ruc@edate
    \end{center}}
  \end{center}}
%    \end{macrocode}
% \end{macro}
%
% \myentry{授权页面}
% \begin{macro}{\ruc@authorization@mk}
% \changes{thuthesis v4.0}{2007/11/08}{研究生的授权部分调整了一下，不知道老师为什么总爱修改
% 那些无关紧要的格式，郁闷。感谢 PMHT@newsmth 的认真比对。}
% \changes{thuthesis v4.4.2}{2008/06/07}{修改本科生的授权部分，按照 2008 年的新样例。}
% 支持扫描文件替换。
%    \begin{macrocode}
\newcommand{\ruc@authorization@mk}{%
  \thispagestyle{ruc@cover}
  \ifruc@bachelor\vspace*{0.2cm}\else\vspace*{0.42cm}\fi % shit code!
  \begin{center}\sanhao\heiti\ruc@declarename\end{center}
  \vskip5pt\par
  \ruc@declaretext\par
  \vskip1.5cm
  {\def\arraystretch{1.5}
  \hspace*{10.0cm}\begin{tabular}{ll}
    \ruc@authorsig & \hspace{7em}\\
    & \ruc@sigdate\\
  \end{tabular}}
  \vskip2.2cm
  \begin{center}\sanhao\heiti\ruc@authtitle\end{center}
  \vskip5pt\par
  \ruc@authorization\par
  \ruc@authorizationaddon\par
  \vskip1.5cm
  {\def\arraystretch{1.5}
  \hspace*{10.0cm}\begin{tabular}{ll}
    \ruc@authorsig & \hspace{7em}\\
     & \ruc@sigdate\\
    \ruc@teachersig & \hspace{7em}\\
     & \ruc@sigdate\\
  \end{tabular}}
}
%    \end{macrocode}
% \end{macro}
%
% \begin{macro}{\makecover}
% 生成封面总命令。
% \changes{thuthesis v2.1}{2006/02/29}{分成几个小模块来搞，不然这个 macro 太大了，看不过来。}
%    \begin{macrocode}
\def\makecover{%
  \ruc@setup@pdfinfo\ruc@makecover}
\def\ruc@setup@pdfinfo{%
  \hypersetup{%
    pdftitle={\ruc@ctitle},
    pdfauthor={\ruc@cauthor},
    pdfsubject={\ruc@bachelor@subtitle},
    pdfkeywords={\ruc@ckeywords},
    pdfcreator={\ructhesis-v\version}}}
\NewDocumentCommand{\ruc@makecover}{o}{
  \phantomsection
  \pdfbookmark[-1]{\ruc@ctitle}{ctitle}
  \normalsize%
  \begin{titlepage}
%    \end{macrocode}
%
% 论文封面第一页！
%    \begin{macrocode}
   \thispagestyle{ruc@cover}\ruc@first@titlepage
%    \end{macrocode}
%
% \changes{thuthesis v2.5}{2006/05/19}{本科论文评语位置调整。}
% \changes{thuthesis v3.0}{2007/05/12}{本科论文评语取消。}
% \changes{thuthesis v4.7}{2011/11/28}{硕士论文也需要英文封面。}
%
% 研究生论文需要增加英文封面
%    \begin{macrocode}
    \ifruc@bachelor\relax\else
      \cleardoublepage\ruc@engcover
    \fi
%    \end{macrocode}
%
% 授权说明和附加页
% \changes{thuthesis v3.0}{2007/05/12}{本科论文授权图片扫描取消。}
% \changes{thuthesis v4.5.2}{2010/05/29}{本科封面和授权说明之间不要空白页。}
% \changes{thuthesis v4.6}{2011/05/29}{博士后报告无授权说明。}
% \changes{thuthesis v5.0.0}{2015/06/05}{使用 \pkg{pdfpages} 宏包支持本硕博论文授权说明扫描版(\#36)。}
% \changes{ructhesis v0.0.1}{2017/05/09}{增加封面附加页。}
%    \begin{macrocode}
    \ifruc@bachelor
      \ifruc@twosideprint\cleardoublepage\else\clearpage\fi
    \else
      \cleardoublepage
    \fi%
    \IfNoValueTF{#1}{%
      \ifruc@bachelor\ruc@authorization@mk\else%
        \begin{list}{}{%
          \topsep\z@%
          \listparindent\parindent%
          \parsep\parskip%
          \setlength{\leftmargin}{0.9mm}%
          \setlength{\rightmargin}{0.9mm}}%
        \item[]\ruc@authorization@mk%
        \end{list}%
      \fi%
    }{%
      \includepdf{#1}%
    }%
    \ifdefined\ruc@addpages
      \ifruc@bachelor
        \ifruc@twosideprint\cleardoublepage\else\clearpage\fi
      \else
        \cleardoublepage
      \fi
      \pagestyle{ruc@cover}\ruc@addpages
    \fi
  \end{titlepage}
%    \end{macrocode}
%
% \changes{thuthesis v2.5}{2006/05/16}{综合论文训练在授权说明之后。}
% \changes{thuthesis v3.0}{2007/05/12}{本科综合论文训练在电子版中取消。}
%
% 中英文摘要
%    \begin{macrocode}
  \normalsize
  \ruc@makeabstract
  \let\@tabular\ruc@tabular}
%</cls>
%    \end{macrocode}
% \end{macro}
%
% \subsubsection{摘要}
% \label{sec:abstractformat}
%
% \begin{macro}{\ruc@put@keywords}
% 排版关键字。
%    \begin{macrocode}
%<*cls>
\newbox\ruc@kw
\newcommand\ruc@put@keywords[2]{%
  \begingroup
    \setbox\ruc@kw=\hbox{#1}
    \ifruc@bachelor\noindent\else\noindent\hangindent\wd\ruc@kw\hangafter1\fi%
    \box\ruc@kw#2\par
  \endgroup}
%    \end{macrocode}
% \end{macro}
%
% \begin{macro}{\ruc@makeabstract}
% 中文摘要部分的标题为\textbf{摘要}，用黑体三号字。
% \changes{thuthesis v2.5.1}{2006/05/24}{教务处又不要正文前的页眉了。}
% \changes{thuthesis v2.5.1}{2006/05/24}{不管是哪种论文格式，摘要都要右开。}
% \changes{thuthesis v2.5.2}{2006/05/29}{在研究生论文中，摘要不出现在目录中，但是要在书签中出现。}
% \changes{thuthesis v2.5.3}{2006/06/03}{\cs{pagenumber} 会自动设置页码为 1。}
% \changes{thuthesis v2.6.3}{2006/06/30}{为本科正确设置目录及以后的页码。}
% \changes{thuthesis v4.5.2}{2010/05/29}{本科论文摘要亦无需右开。}
%    \begin{macrocode}
\newcommand{\ruc@makeabstract}{%
  \ifruc@bachelor
    \ifruc@twosideprint\cleardoublepage\else\clearpage\fi
  \else
    \cleardoublepage
  \fi
  \ruc@chapter*[]{\cabstractname} % no tocline
  \ifruc@bachelor
    \pagestyle{ruc@logo}
  \else
    \pagestyle{ruc@headings}
  \fi
  \pagenumbering{Roman}
%    \end{macrocode}
%
% 摘要内容用小四号字书写，两端对齐，汉字用宋体，外文字用 Times New Roman 体，
% 标点符号一律用中文输入状态下的标点符号。
% \changes{thuthesis v3.1}{2007/06/16}{研究生关键词不再沉底。}
%    \begin{macrocode}
  \ruc@cabstract
%    \end{macrocode}
% 每个关键词之间空两个汉字符宽度， 且为悬挂缩进。
% \changes{thuthesis v2.6.2}{2006/06/17}{取消最后一列的空白。}
% \changes{thuthesis v2.6.2}{2006/06/20}{取消 tabular 环境，用 \cs{hangindent} 实现关键词
% 悬挂缩进，英文摘要同。}
% \changes{thuthesis v4.4.2}{2008/06/05}{本科生格式中文关键词采用首行缩进且无悬挂缩进。}
%    \begin{macrocode}
  \vskip12bp
  \ruc@put@keywords{\heiti\ruc@ckeywords@title}{\ruc@ckeywords}
%    \end{macrocode}
%
% 英文摘要部分的标题为 \textbf{Abstract}，用 Arial 体三号字。研究生的英文摘要要求
% 非常怪异：虽然正文前的封面部分为右开，但是英文摘要要跟中文摘要连续。
% \changes{thuthesis v2.5.1}{2006/05/28}{研究生封面英文摘要连续。}
%    \begin{macrocode}
  \ruc@chapter*[]{\bfseries\eabstractname} % no tocline
%    \end{macrocode}
%
% 摘要内容用小四号 Times New Roman。
%    \begin{macrocode}
  \ruc@eabstract
%    \end{macrocode}
%
% 每个关键词之间空四个英文字符宽度。
% \changes{thuthesis v2.4}{2006/04/14}{It is \textbf{Key words}, but not \textbf{Key
% Words}.}
% \changes{thuthesis v2.6.2}{2006/06/17}{取消最后一列的空白。}
% \changes{thuthesis v2.6.4}{2006/10/23}{\textbf{Keywords} but not \textbf{Key words}.}
% \changes{thuthesis v3.0}{2007/05/13}{\textbf{Key words} but not
% \textbf{Keywords}. What are you doing?}
% \changes{thuthesis v4.4.2}{2008/06/05}{Bachelor English abstract format requires
% indent and no hang-indent.}
% \changes{thuthesis v4.7}{2012/06/02}{Bachelor sample uses Keywords w/o space \texttt{-\_-}}
%    \begin{macrocode}
  \vskip12bp
  \ruc@put@keywords{%
    \textbf{\ifruc@bachelor Keywords:\else Key words:\fi\enskip}}{\ruc@ekeywords}}
%</cls>
%    \end{macrocode}
% \end{macro}
%
% \subsubsection{主要符号表}
% \label{sec:denotationfmt}
% \begin{environment}{denotation}
% 主要符号对照表。
% \changes{thuthesis v2.0e}{2005/12/18}{主要符号表定义为一个 list，用起来方便。}
% \changes{thuthesis v2.4}{2006/04/14}{为主要符号表环境增加一个可选参数，调节符号列的宽度。}
% \changes{thuthesis v5.2.1}{2016/01/11}{利用 \pkg{enumitem} 改造环境定义，更直观。}
%    \begin{macrocode}
%<*cfg>
\newcommand{\ruc@denotation@name}{主要符号对照表}
%</cfg>
%<*cls>
\newenvironment{denotation}[1][4.5cm]{%
  \ruc@chapter*{\ruc@denotation@name} % no tocline
  \vskip-30bp\xiaosi[1.6]\begin{ruc@denotation}[labelwidth=#1]
}{%
  \end{ruc@denotation}
}
\newlist{ruc@denotation}{description}{1}
\setlist[ruc@denotation]{%
  nosep,
  font=\normalfont,
  align=left,
  leftmargin=!, % sum of the following 3 lengths
  labelindent=0pt,
  labelwidth=2.5cm,
  labelsep*=0.5cm,
  itemindent=0pt,
}
%</cls>
%    \end{macrocode}
% \end{environment}
%
%
% \subsubsection{致谢}
% \label{sec:ackanddeclare}
%
% \begin{environment}{acknowledgement}
% 致谢。
% \changes{thuthesis v2.4}{2006/04/14}{调整\textbf{致谢}等中间的距离。}
%    \begin{macrocode}
%<*cfg>
\newcommand{\ruc@ackname}{致\hspace{1em}谢}
%</cfg>
%    \end{macrocode}
%
% \changes{thuthesis v2.0}{2005/12/19}{将致谢定义为一个环境更合适，里面也不用像以前段首需
% 要自己缩进。}
% \changes{thuthesis v1.5}{2005/12/16}{在那些不显示编号的章节前面先执行一次
%  \cs{cleardoublepage}，使新开章节的页码到达正确的状态。否则会因为 \cs{addcontentsline}
% 在 chapter 之前而导致目录页码错误。}
% 定义致谢与声明环境。
% \changes{thuthesis v2.5}{2006/05/16}{本科论文要求致谢声明分页，但是研究生的不分。}
% \changes{thuthesis v2.5.2}{2006/05/29}{研究生致谢右开。}
% \changes{thuthesis v2.5.2}{2006/05/30}{研究生致谢题目是致谢，目录是致谢与声明。}
% \changes{thuthesis v2.6.3}{2006/07/01}{重画双虚线，自适应页面宽度。}
% \changes{thuthesis v4.5.2}{2010/09/19}{研究生论文的致谢和声明终于分开了。}
% \changes{thuthesis v5.2.1}{2016/01/11}{用 \env{acknowledgement} 替换 \env{ack}。}
%    \begin{macrocode}
%<*cls>
\NewDocumentEnvironment{acknowledgement}{o}{%
    \ruc@chapter*{\ruc@ackname}
  }
%    \end{macrocode}
%
% \changes{thuthesis v3.0}{2007/05/12}{本科论文声明部分图片扫描取消。}
% \changes{thuthesis v5.0.0}{2015/06/05}{使用 pdfpages 宏包支持本硕博论文声明扫描版(\#36)。}
% \changes{ructhesis v0.0.1}{2017/05/09}{将声明移至扉页。}
%    \begin{macrocode}
  {\relax}
%    \end{macrocode}
% \end{environment}
% \begin{environment}{ack}
% 兼容旧版本保留 \env{ack}。
%    \begin{macrocode}
\let\ack\acknowledgement
\let\endack\endacknowledgement
%</cls>
%    \end{macrocode}
% \end{environment}
%
% \subsubsection{图表索引}
% \label{sec:threeindex}
% \begin{macro}{\listoffigures}
% \begin{macro}{\listoffigures*}
% \begin{macro}{\listoftables}
% \begin{macro}{\listoftables*}
% 定义图表以及公式目录样式。
% \changes{thuthesis v2.5}{2006/05/18}{增加插图、表格和公式索引。}
% \changes{thuthesis v2.5}{2006/05/19}{为了让索引中能出现\textbf{图 xxx}，不得不修改 \LaTeX
%   内部命令 \cs{@caption}。}
% \changes{thuthesis v2.6.4}{2006/10/23}{增加 \cs{listoffigures*}，\cs{listoftables*}。}
% \changes{thuthesis v4.5.1}{2009/01/06}{更优雅的插图/表格索引，避免跟 \pkg{caption} 包冲
% 突。\cs{thu@listof} 相应修改。}
%    \begin{macrocode}
%<*cls>
\def\ruc@starttoc#1{% #1: float type, prepend type name in \listof*** entry.
  \let\oldnumberline\numberline
  \def\numberline##1{\oldnumberline{\csname #1name\endcsname\hskip.4em ##1}}
  \@starttoc{\csname ext@#1\endcsname}
  \let\numberline\oldnumberline}
\def\ruc@listof#1{% #1: float type
  \@ifstar
    {\ruc@chapter*[]{\csname list#1name\endcsname}\ruc@starttoc{#1}}
    {\ruc@chapter*{\csname list#1name\endcsname}\ruc@starttoc{#1}}}
\renewcommand\listoffigures{\ruc@listof{figure}}
\renewcommand*\l@figure{\addvspace{6bp}\@dottedtocline{1}{0em}{4em}}
\renewcommand\listoftables{\ruc@listof{table}}
\let\l@table\l@figure
%    \end{macrocode}
% \end{macro}
% \end{macro}
% \end{macro}
% \end{macro}
%
% \begin{macro}{\equcaption}
% \changes{thuthesis v2.6.2}{2006/06/19}{此命令配合 \pkg{amsmath} 命令基本可以满足所有
% 公式需要。}
%   本命令只是为了生成公式列表，所以这个 caption 是假的。如果要编号最好用
%    equation 环境，如果是其它编号环境，请手动添加添加 \cs{equcaption}。
% 用法如下：
%
% \cs{equcaption}\marg{counter}
%
% \marg{counter} 指定出现在索引中的编号，一般取 \cs{theequation}，如果你是用
%  \pkg{amsmath} 的 \cs{tag}，那么默认是 \cs{tag} 的参数；除此之外可能需要你
% 手工指定。
%
% \changes{thuthesis v2.5}{2006/05/19}{将公式编号写入临时文件以便生成公式列表。}
% \changes{thuthesis v2.5.3}{2006/06/03}{取消 \cs{equcaption} 的参数}
%    \begin{macrocode}
\def\ext@equation{loe}
\def\equcaption#1{%
  \addcontentsline{\ext@equation}{equation}%
                  {\protect\numberline{#1}}}
%    \end{macrocode}
% \end{macro}
%
% \begin{macro}{\listofequations}
% \begin{macro}{\listofequations*}
% \LaTeX\ 默认没有公式索引，此处定义自己的 \cs{listofequations}。
% \changes{thuthesis v2.5}{2006/05/19}{增加公式索引命令。}
% \changes{thuthesis v2.5.1}{2006/05/26}{公式索引项 numwidth 增加。}
% \changes{thuthesis v2.6.4}{2006/10/23}{增加 \cs{listofequations*}。}
%    \begin{macrocode}
\newcommand\listofequations{\ruc@listof{equation}}
\let\l@equation\l@figure
%</cls>
%    \end{macrocode}
% \end{macro}
% \end{macro}
%
%
% \subsection{参考文献}
% \label{sec:ref}
%
% \begin{macro}{\inlinecite}
% 正文引用模式。依赖于 \pkg{natbib} 宏包，修改其中的命令。旧命令 \cs{onlinecite}
% 依然可用。
% \changes{thuthesis v5.0.0}{2015/11/23}{用 \cs{inlinecite} 替换 \cs{onlinecite}。为保证兼
% 容性，\cs{onlinecite} 会保留。}
%    \begin{macrocode}
%<*cls>
\bibpunct{[}{]}{,}{s}{}{,}
\renewcommand\NAT@citesuper[3]{\ifNAT@swa%
  \unskip\kern\p@\textsuperscript{\NAT@@open #1\NAT@@close}%
  \if*#3*\else\ (#3)\fi\else #1\fi\endgroup}
\DeclareRobustCommand\inlinecite{\@inlinecite}
\def\@inlinecite#1{\begingroup\let\@cite\NAT@citenum\citep{#1}\endgroup}
\let\onlinecite\inlinecite
%    \end{macrocode}
% \end{macro}
%
% 参考文献的正文部分用五号字。
% 行距采用固定值 16 磅，段前空 3 磅，段后空 0 磅。
% 本科生要求固定行距 17pt，段前后间距 3pt。
%
% \begin{macro}{\rucdot}
% 研究生参考文献条目最后可加点，图书文献一般不加。
% 本科生未作说明。
% 只好定义一个东西来拙劣地处理了，
% 本来这个命令通过 \texttt{@preamble} 命令放到 bib 文件中是最省事的，但是那
% 样的话很多人肯定不知道该怎么做了。
% \changes{thuthesis v3.1}{2007/06/19}{引入 \cs{thudot} 来自动完成参考文献最后的点。}
%    \begin{macrocode}
\def\rucdot{\ifruc@bachelor\unskip.\else\unskip.\fi}
%</cls>
%    \end{macrocode}
% \end{macro}
% \begin{macro}{\rucmasterbib}
% \begin{macro}{\rucphdbib}
%   本科生和研究生模板要求外文硕士论文参考文献显示``[Master Thesis]''，而博士模板
%   则于 2007 年冬要求显示为``[M]''。对应的外文博士论文参考文献分别显示为``[Phd
%   Thesis]''和``[D]''。
%   研究生写作指南(201109)要求：
%   中文硕士学位论文标注``[硕士学位论文]''，
%   中文博士学位论文标注``[博士学位论文]''，外文学位论文标注``[D]''。
%   本科生写作指南未指定，参考文献著录格式文档中对中外文学位论文都标注``[D]''。
% \changes{thuthesis v4.7}{2012/05/29}{修改两个宏使其对应不同的中文论文需求。}
%    \begin{macrocode}
%<*cfg>
\def\rucmasterbib{\ifruc@bachelor [D]\else [硕士学位论文]\fi}
\def\rucphdbib{\ifruc@bachelor [D]\else [博士学位论文]\fi}
%</cfg>
%    \end{macrocode}
% \end{macro}
% \end{macro}
% \begin{environment}{thebibliography}
% 修改默认的 thebibliography 环境，增加一些调整代码。
% \changes{thuthesis v2.4}{2006/04/15}{参考文献间距调小一点，label 长度增加一点，以便让超过
%  100 的参考文献更好地对齐。}
% \changes{thuthesis v2.5}{2006/05/13}{参考文献序号靠左，而不是靠右。}
% \changes{thuthesis v2.6.4}{2006/10/23}{调整参考文献标签宽度，使得条目增多时仍能对齐。}
%    \begin{macrocode}
%<*cls>
\renewenvironment{thebibliography}[1]{%
   \ruc@chapter*{\bibname}%
   \wuhao[1.5]
   \list{\@biblabel{\@arabic\c@enumiv}}%
        {\renewcommand{\makelabel}[1]{##1\hfill}
         \settowidth\labelwidth{1.1cm}
         \setlength{\labelsep}{0.4em}
         \setlength{\itemindent}{0pt}
         \setlength{\leftmargin}{\labelwidth+\labelsep}
         \addtolength{\itemsep}{-0.7em}
         \usecounter{enumiv}%
         \let\p@enumiv\@empty
         \renewcommand\theenumiv{\@arabic\c@enumiv}}%
    \sloppy\frenchspacing
    \clubpenalty4000
    \@clubpenalty \clubpenalty
    \widowpenalty4000%
    \interlinepenalty4000%
    \sfcode`\.\@m}
   {\def\@noitemerr
     {\@latex@warning{Empty `thebibliography' environment}}%
    \endlist\frenchspacing}
%</cls>
%    \end{macrocode}
% \end{environment}
%
%
% \subsection{附录}
% \label{sec:appendix}
% \begin{environment}{appendix}
% 放代码、文献材料。
%    \begin{macrocode}
%<*cls>
\let\ruc@appendix\appendix
\renewenvironment{appendix}{%
  \let\title\ruc@appendix@title
  \ruc@appendix}{%
  \let\title\@gobble}
%    \end{macrocode}
% \end{environment}
%
% \begin{macro}{\title}
% \changes{thuthesis v5.2.0}{2016/01/11}{增加 \cs{title} 排版翻译标题。}
% 本科外文翻译文章的标题，用法：\cs{title}\marg{资料标题}。这个命令只能在附录环
% 境下使用。
%    \begin{macrocode}
\let\title\@gobble
\newcommand{\ruc@appendix@title}[1]{%
  \begin{center}
    \bfseries\xiaosi #1
  \end{center}}
%    \end{macrocode}
% \end{macro}
%
% \begin{environment}{translationbib}
% \changes{thuthesis v5.2.0}{2016/01/11}{增加翻译文献环境 \env{translationbib}。}
% 外文资料的参考文用宋体五号字，取固定行距17pt，段前后3pt。
%    \begin{macrocode}
\newlist{translationbib}{enumerate}{1}
\setlist[translationbib]{label=[\arabic*],align=left,nosep,itemsep=6bp,
  leftmargin=10mm,labelsep=!,before=\vspace{0.5\baselineskip}\wuhao[1.3]}
%</cls>
%    \end{macrocode}
% \end{environment}
%
% \subsection{个人简历}
%
% \begin{environment}{resume}
% \changes{thuthesis v1.5}{2005/12/16}{增加个人简历章节的命令，去掉主文件中需要重新
% 定义 \cs{cleardoublepage} 和自己写 \cs{markboth}，\cs{addcontentsline} 的部分。}
% \changes{thuthesis v2.0}{2005/12/18}{最后决定将 resume 定义为环境。这样与前面的主要符号
% 表、致谢等对应。}
% \changes{thuthesis v2.5.1}{2006/05/23}{教务处和研究生院非要搞的不一样！}
% \changes{thuthesis v2.5.2}{2006/05/29}{研究生的个人介绍要右开。}
% \changes{thuthesis v4.6}{2011/05/02}{支持可选参数，自己定义简历章节标题。}
% 个人简历发表文章等。
%    \begin{macrocode}
%<*cfg>
\ifruc@bachelor
  \newcommand{\ruc@resume@title}{在学期间参加课题的研究成果}
\else
  \newcommand{\ruc@resume@title}{个人简历、在学期间发表的学术论文与研究成果}
\fi
%</cfg>
%<*cls>
\newenvironment{resume}[1][\ruc@resume@title]{%
  \ruc@chapter*{#1}}{}
%    \end{macrocode}
% \end{environment}
%
% \begin{macro}{\resumeitem}
% 个人简历部分。每条信息一个段落，故不需要特别处理。
%    \begin{macrocode}
\newcommand{\resumeitem}[1]{%
  \vspace{24bp}{\sihao\heiti\centerline{#1}}\par\vspace{6bp}}
%    \end{macrocode}
% \end{macro}
%
% \begin{macro}{\researchitem}
% 研究成果用 \cs{researchitem}\marg{类别} 开启，包括“学术论文”和“研究成果”两个
% 列表。
%    \begin{macrocode}
\newcommand{\researchitem}[1]{%
  \vspace{32bp}{\sihao\heiti\centerline{#1}}\par\vspace{14bp}}
%    \end{macrocode}
% \end{macro}
%
% \begin{environment}{publications}
% \begin{environment}{achievements}
% 二者分别通过两个环境 \env{publications} 和 \env{achievements} 罗
% 列。
%
% \changes{thuthesis v5.0.0}{2015/04/18}{博士后就不提在学期间了，不合适(\#100)}
% \changes{thuthesis v5.0.0}{2015/05/17}{让简历部分更符合格式指南和示例文件(\#122)}
%    \begin{macrocode}
\newlist{publications}{enumerate}{1}
\setlist[publications]{label=[\arabic*],align=left,nosep,itemsep=8bp,
  leftmargin=10mm,labelsep=!,before=\xiaosi[1.26],resume}
\newlist{achievements}{enumerate}{1}
\setlist[achievements]{label=[\arabic*],align=left,nosep,itemsep=8bp,
  leftmargin=10mm,labelsep=!,before=\xiaosi[1.26]}
%    \end{macrocode}
% \end{environment}
% \end{environment}
%
% \begin{macro}{\publicationskip}
% \changes{thuthesis v5.2.0}{2016/01/11}{增加 \cs{publicationskip}。}
% \env{publications} 环境可以连续出现多次，第二类论文列表前后要空一行，使
% 用 \cs{publicationskip}。
%    \begin{macrocode}
\def\publicationskip{\bigskip\bigskip}
%</cls>
%    \end{macrocode}
% \end{macro}
%
% \subsection{自定义命令和环境}
% \label{sec:userdefine}
%
% \begin{macro}{\pozhehao}
% 为了兼容性保留之，推荐直接输入“——”。
% \changes{thuthesis v2.1}{2006/01/12}{稍微加宽一点。同时把名字改为\textbf{破折号}：\cs{pozhehao}}
%    \begin{macrocode}
%<*cfg>
\newcommand{\pozhehao}{——}
%</cfg>
%    \end{macrocode}
% \end{macro}
%
%
% \subsection{其它}
% \label{sec:other}
%
% 在模板文档结束时即装入配置文件，这样用户就能在导言区进行相应的修改。
% \changes{thuthesis v2.5}{2006/05/13}{不用 \cs{CJKcaption}，在导言区直接引入配置文件。}
%    \begin{macrocode}
%<*cls>
\AtEndOfClass{\input{ructhesis.cfg}}
\AtEndOfClass{\sloppy}
%</cls>
%    \end{macrocode}
%
%
% \iffalse
%    \begin{macrocode}
%<*dtx-style>
\ProvidesPackage{dtx-style}
\RequirePackage{hypdoc}
\RequirePackage[UTF8,scheme=chinese]{ctex}
\RequirePackage{newpxtext}
\RequirePackage{newpxmath}
\RequirePackage[
  top=2.5cm, bottom=2.5cm,
  left=4cm, right=2cm,
  headsep=3mm]{geometry}
\RequirePackage{array,longtable,booktabs}
\RequirePackage{listings}
\RequirePackage{fancyhdr}
\RequirePackage{xcolor}
\RequirePackage{enumitem}
\RequirePackage{etoolbox}
\RequirePackage{metalogo}

\definecolor{rucred}{cmyk}{.20, 1, .80, .20}
\colorlet{ruc@macro}{blue!60!black}
\colorlet{ruc@env}{blue!70!black}
\colorlet{ruc@option}{rucred}
\patchcmd{\PrintMacroName}{\MacroFont}{\MacroFont\bfseries\color{ruc@macro}}{}{}
\patchcmd{\PrintDescribeMacro}{\MacroFont}{\MacroFont\bfseries\color{ruc@macro}}{}{}
\patchcmd{\PrintDescribeEnv}{\MacroFont}{\MacroFont\bfseries\color{ruc@env}}{}{}
\patchcmd{\PrintEnvName}{\MacroFont}{\MacroFont\bfseries\color{ruc@env}}{}{}

\def\DescribeOption{%
  \leavevmode\@bsphack\begingroup\MakePrivateLetters%
  \Describe@Option}
\def\Describe@Option#1{\endgroup
  \marginpar{\raggedleft\PrintDescribeOption{#1}}%
  \ruc@special@index{option}{#1}\@esphack\ignorespaces}
\def\PrintDescribeOption#1{\strut \MacroFont\bfseries\sffamily\color{ruc@option} #1\ }
\def\ruc@special@index#1#2{\@bsphack
  \begingroup
    \HD@target
    \let\HDorg@encapchar\encapchar
    \edef\encapchar usage{%
      \HDorg@encapchar hdclindex{\the\c@HD@hypercount}{usage}%
    }%
    \index{#2\actualchar{\string\ttfamily\space#2}
           (#1)\encapchar usage}%
    \index{#1:\levelchar#2\actualchar
           {\string\ttfamily\space#2}\encapchar usage}%
  \endgroup
  \@esphack}

\lstdefinestyle{lstStyleBase}{%
   basicstyle=\small\ttfamily,
   aboveskip=\medskipamount,
   belowskip=\medskipamount,
   lineskip=0pt,
   boxpos=c,
   showlines=false,
   extendedchars=true,
   upquote=true,
   tabsize=2,
   showtabs=false,
   showspaces=false,
   showstringspaces=false,
   numbers=none,
   linewidth=\linewidth,
   xleftmargin=4pt,
   xrightmargin=0pt,
   resetmargins=false,
   breaklines=true,
   breakatwhitespace=false,
   breakindent=0pt,
   breakautoindent=true,
   columns=flexible,
   keepspaces=true,
   gobble=2,
   framesep=3pt,
   rulesep=1pt,
   framerule=1pt,
   backgroundcolor=\color{gray!5},
   stringstyle=\color{green!40!black!100},
   keywordstyle=\bfseries\color{blue!50!black},
   commentstyle=\slshape\color{black!60}}

\lstdefinestyle{lstStyleShell}{%
   style=lstStyleBase,
   frame=l,
   rulecolor=\color{violet},
   language=bash}

\lstdefinestyle{lstStyleLaTeX}{%
   style=lstStyleBase,
   frame=l,
   rulecolor=\color{rucred},
   language=[LaTeX]TeX}

\lstnewenvironment{latex}{\lstset{style=lstStyleLaTeX}}{}
\lstnewenvironment{shell}{\lstset{style=lstStyleShell}}{}

\setlist{nosep}

\DeclareDocumentCommand{\option}{m}{\textsf{#1}}
\DeclareDocumentCommand{\env}{m}{\texttt{#1}}
\DeclareDocumentCommand{\pkg}{s m}{%
  \texttt{#2}\IfBooleanF#1{\ruc@special@index{package}{#2}}}
\DeclareDocumentCommand{\file}{s m}{%
  \texttt{#2}\IfBooleanF#1{\ruc@special@index{file}{#2}}}
\newcommand{\myentry}[1]{%
  \marginpar{\raggedleft\color{purple}\bfseries\strut #1}}
\newcommand{\note}[2][Note]{{%
  \color{magenta}{\bfseries #1}\emph{#2}}}

\def\ructhesis{\textsc{Ruc}\-\textsc{Thesis}}
%</dtx-style>
%    \end{macrocode}
% \fi
%
% \Finale
%
\endinput
% \iffalse
%  Local Variables:
%  mode: doctex
%  TeX-master: t
%  End:
% \fi
